#!/usr/bin/env node
var ref$, reject, each, keys, map, elemIndex, findIndex, join, isType, compact, concat, name, version, fs, download, downloadStatus, mkdirp, msg, tsvToI18n, genI18nFromUrl, argv, destFolder, format, slice$ = [].slice;
ref$ = require('prelude-ls'), reject = ref$.reject, each = ref$.each, keys = ref$.keys, map = ref$.map, elemIndex = ref$.elemIndex, findIndex = ref$.findIndex, join = ref$.join, isType = ref$.isType, compact = ref$.compact, concat = ref$.concat;
ref$ = require('../package'), name = ref$.name, version = ref$.version;
fs = require('fs');
download = require('download');
downloadStatus = require('download-status');
mkdirp = require('mkdirp');
msg = function(m){
  return console.log(name + " (" + version + "): " + m);
};
tsvToI18n = function(rawText, destFolder, format){
  var ref$, header, lines, locales, headerItems, prefixKeys;
  ref$ = rawText.toString().split('\r\n'), header = ref$[0], lines = slice$.call(ref$, 1);
  locales = {};
  headerItems = header.split('\t');
  each(function(it){
    if (it !== '' && it !== '#' && it !== 'remark') {
      return locales[it] = elemIndex(it, headerItems);
    }
  })(
  headerItems);
  switch (false) {
  case format !== 'yaml' && format !== 'yml':
    msg("Generating " + format + " files ...");
    return each(function(lang){
      var yamlLines, outputFile;
      yamlLines = join('\n')(
      map(function(line){
        var lineItems, keyIndex, indentNKey, value;
        lineItems = line.split('\t');
        keyIndex = findIndex(function(it){
          return it !== '';
        })(
        lineItems);
        if (!isType('Undefined', keyIndex)) {
          indentNKey = repeatString$('  ', keyIndex) + "" + lineItems[keyIndex];
          value = lineItems[locales[lang]];
          if (/^[\{\[]/.test(value)) {
            value = "'" + value + "'";
          }
          return line = (indentNKey + ":") + (value ? " " + value : '');
        }
      })(
      lines));
      outputFile = destFolder + "/" + lang + ".i18n.yml";
      msg("\t -> " + outputFile);
      return fs.writeFileSync(outputFile, yamlLines, {
        flag: 'w'
      });
    })(
    keys(
    locales));
  case !in$(format, ['json']):
    msg("Generating " + format + " files ...");
    prefixKeys = [];
    return each(function(lang){
      var jsonLines, jsonContent, outputFile;
      jsonLines = join(',\n')(
      reject(function(it){
        return it === '';
      })(
      map(function(line){
        var jsonLine, lineItems, keyIndex, compactedItems, thisKey, thisValue;
        jsonLine = '';
        lineItems = line.split('\t');
        keyIndex = findIndex(function(it){
          return it !== '';
        })(
        lineItems);
        compactedItems = compact(lineItems);
        if (keyIndex === 0) {
          prefixKeys = [];
        }
        if (compactedItems.length === 1) {
          prefixKeys[keyIndex] = compactedItems[0];
        }
        if (compactedItems.length > 1) {
          thisKey = compactedItems[0];
          thisValue = lineItems[locales[lang]].replace(/\"/gi, '\\"');
          jsonLine = "  \"" + join('.')(
          concat([prefixKeys, [thisKey]])) + "\" : \"" + thisValue + "\"";
        }
        return jsonLine;
      })(
      lines)));
      jsonContent = "{\n" + jsonLines + "\n}";
      outputFile = destFolder + "/" + lang + ".json";
      msg("\t -> " + outputFile);
      return fs.writeFileSync(outputFile, jsonContent, {
        flag: 'w'
      });
    })(
    keys(
    locales));
  default:
    return msg("Unsupported format!");
  }
};
genI18nFromUrl = function(url, destFolder, format){
  url = url || '';
  destFolder = destFolder || '.';
  return mkdirp(destFolder, function(err){
    if (err) {
      return msg("Error creating destination folder: " + destFolder);
    } else {
      msg("Created destination folder: " + destFolder);
      msg("Getting source TSV file from: " + url);
      return download(url).then(function(data){
        return tsvToI18n(data.toString(), destFolder, format);
      });
    }
  });
};
argv = require('minimist')(process.argv.slice(2));
destFolder = argv.p || '.';
format = argv.f || 'yml';
genI18nFromUrl(argv.s, destFolder, format);
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9pbmRleC5scyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLElBQUEsR0FBc0YsT0FBdEYsQ0FBOEYsWUFBQSxDQUE5RixFQUFFLE1BQWtGLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQUUsTUFBRixFQUFVLElBQTBFLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQVUsSUFBVixFQUFnQixJQUFvRSxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFnQixJQUFoQixFQUFzQixHQUE4RCxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFzQixHQUF0QixFQUEyQixTQUF5RCxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUEyQixTQUEzQixFQUF1QyxTQUE2QyxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUF1QyxTQUF2QyxFQUFtRCxJQUFpQyxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFtRCxJQUFuRCxFQUF5RCxNQUEyQixDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUF5RCxNQUF6RCxFQUFrRSxPQUFrQixDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFrRSxPQUFsRSxFQUEyRSxNQUFTLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQTJFO0FBQzNFLElBQUEsR0FBb0IsT0FBcEIsQ0FBNEIsWUFBQSxDQUE1QixFQUFFLElBQWdCLENBQUEsQ0FBQSxDQUFsQixJQUFBLENBQUUsSUFBRixFQUFRLE9BQVUsQ0FBQSxDQUFBLENBQWxCLElBQUEsQ0FBUTtBQUNSLEVBQUcsQ0FBQSxDQUFBLENBQUUsUUFBUSxJQUFBO0FBQ2IsUUFBUyxDQUFBLENBQUEsQ0FBRSxRQUFRLFVBQUE7QUFDbkIsY0FBZ0IsQ0FBQSxDQUFBLENBQUUsUUFBUSxpQkFBQTtBQUMxQixNQUFPLENBQUEsQ0FBQSxDQUFFLFFBQVEsUUFBQTtBQUVqQixHQUFJLENBQUEsQ0FBQSxDQUFFLFFBQUEsQ0FBQSxDQUFBO1NBQU8sT0FBTyxDQUFDLElBQU8sSUFBSSxDQUFBLENBQUEsQ0FBQyxJQUFBLENBQUEsQ0FBQSxDQUFJLE9BQU8sQ0FBQSxDQUFBLENBQUMsS0FBQSxDQUFBLENBQUEsQ0FBSyxDQUE3Qjs7QUFFckIsU0FBWSxDQUFBLENBQUEsQ0FBRSxRQUFBLENBQUEsT0FBQSxFQUFBLFVBQUEsRUFBQSxNQUFBOztFQUNaLElBQUEsR0FBdUIsT0FBUSxDQUFDLFFBQWhDLENBQXdDLENBQUMsQ0FBQSxLQUF6QyxDQUErQyxNQUFBLENBQS9DLEVBQUUsTUFBbUIsQ0FBQSxDQUFBLENBQXJCLElBQUEsQ0FBQSxDQUFBLENBQUEsRUFBYSxLQUFRLENBQUEsQ0FBQSxDQUFyQjtFQUNBLE9BQVEsQ0FBQSxDQUFBLENBQUU7RUFDVixXQUFhLENBQUEsQ0FBQSxDQUFFLE1BQU0sQ0FBQyxNQUFNLElBQUE7RUFDWixLQUFLLFFBQUEsQ0FBQSxFQUFBO0lBQ25CLElBQUksRUFBQSxLQUFZLEVBQVosSUFBQSxFQUFBLEtBQWUsR0FBZixJQUFBLEVBQUEsS0FBbUIsUUFBdkI7YUFDRSxPQUFPLENBQUMsRUFBRCxDQUFLLENBQUEsQ0FBQSxDQUFFLFVBQVcsSUFBSSxXQUFKOztHQUZSO0VBQXJCO0VBS0EsUUFBQSxLQUFBO0FBQUEsRUFDSyxLQUFBLE1BQUEsS0FBVyxNQUFYLElBQUEsTUFBQSxLQUFtQixLQUFuQjtBQUFBLElBQ0gsSUFBSSxhQUFBLENBQUEsQ0FBQSxDQUFjLE1BQU0sQ0FBQSxDQUFBLENBQUMsWUFBekI7V0FDbUIsS0FBSyxRQUFBLENBQUEsSUFBQTs7TUFDdEIsU0FBVyxDQUFBLENBQUEsQ0FhRSxLQUFLLElBQUE7TUFaTCxJQUFJLFFBQUEsQ0FBQSxJQUFBOztRQUNILFNBQVcsQ0FBQSxDQUFBLENBQUUsSUFBSSxDQUFDLE1BQU0sSUFBQTtRQUd4QixRQUFVLENBQUEsQ0FBQSxDQUFnQixVQUFXLFFBQUEsQ0FBQSxFQUFBO2lCQUFHLEVBQUcsQ0FBQSxHQUFBLENBQUc7U0FBVDtRQUF6QjtRQUNaLElBQUEsQ0FBTyxNQUFQLENBQWUsV0FBZixFQUE0QixRQUFiLENBQWY7VUFDRSxVQUFhLENBQUEsQ0FBQSxDQUFVLGFBQUEsQ0FBTCxJQUFLLEVBQUUsUUFBRixDQUFXLENBQUEsQ0FBQSxDQUFDLEVBQUEsQ0FBQSxDQUFBLENBQUUsU0FBVSxDQUFDLFFBQUQ7VUFFL0MsS0FBTSxDQUFBLENBQUEsQ0FBRSxTQUFVLENBQUMsT0FBTyxDQUFDLElBQUQsQ0FBUjtVQUNsQixJQUFHLFNBQVMsQ0FBQyxJQUFiLENBQWtCLEtBQUQsQ0FBakI7WUFDRSxLQUFNLENBQUEsQ0FBQSxDQUFFLEdBQUEsQ0FBQSxDQUFBLENBQUksS0FBSyxDQUFBLENBQUEsQ0FBQzs7aUJBQ3BCLElBQUssQ0FBQSxDQUFBLENBQUEsQ0FBSyxVQUFZLENBQUEsQ0FBQSxDQUFDLEdBQUUsQ0FBQyxDQUFBLENBQUEsQ0FBQSxDQUFNLEtBQU4sQ0FBWSxFQUFLLEdBQUEsQ0FBQSxDQUFBLENBQUksS0FBckIsQ0FBNkIsRUFBSyxFQUFsQzs7T0FYekI7TUFESjtNQWNiLFVBQVksQ0FBQSxDQUFBLENBQUssVUFBVyxDQUFBLENBQUEsQ0FBQyxHQUFBLENBQUEsQ0FBQSxDQUFHLElBQUksQ0FBQSxDQUFBLENBQUM7TUFDckMsSUFBSSxRQUFBLENBQUEsQ0FBQSxDQUFTLFVBQWI7YUFDQSxFQUFHLENBQUMsY0FBYyxZQUFhLFdBQVk7UUFBRSxNQUFNO01BQVIsQ0FBekI7S0FqQkk7SUFBYjtJQUFYO0VBbUJHLEtBQUEsQ0FBQSxHQUFBLENBQUEsTUFBQSxFQUFVLENBQUMsTUFBRCxDQUFWLENBQUE7QUFBQSxJQUNILElBQUksYUFBQSxDQUFBLENBQUEsQ0FBYyxNQUFNLENBQUEsQ0FBQSxDQUFDLFlBQXpCO0lBQ0EsVUFBWSxDQUFBLENBQUEsQ0FBRTtXQUNLLEtBQUssUUFBQSxDQUFBLElBQUE7O01BQ3RCLFNBQVcsQ0FBQSxDQUFBLENBa0JFLEtBQUssS0FBQTtNQURMLE9BQU8sUUFBQSxDQUFBLEVBQUE7ZUFBRyxFQUFHLENBQUEsR0FBQSxDQUFHO09BQVQ7TUFoQlAsSUFBSSxRQUFBLENBQUEsSUFBQTs7UUFDSCxRQUFVLENBQUEsQ0FBQSxDQUFFO1FBQ1osU0FBVyxDQUFBLENBQUEsQ0FBRSxJQUFJLENBQUMsTUFBTSxJQUFBO1FBR3hCLFFBQVUsQ0FBQSxDQUFBLENBQWdCLFVBQVcsUUFBQSxDQUFBLEVBQUE7aUJBQUcsRUFBRyxDQUFBLEdBQUEsQ0FBRztTQUFUO1FBQXpCO1FBQ1osY0FBZ0IsQ0FBQSxDQUFBLENBQUUsUUFBUSxTQUFEO1FBQ3pCLElBQUcsUUFBVSxDQUFBLEdBQUEsQ0FBRyxDQUFoQjtVQUNFLFVBQVksQ0FBQSxDQUFBLENBQUc7O1FBQ2pCLElBQUcsY0FBZSxDQUFDLE1BQU8sQ0FBQSxHQUFBLENBQUcsQ0FBN0I7VUFDRSxVQUFXLENBQUMsUUFBRCxDQUFZLENBQUEsQ0FBQSxDQUFFLGNBQWUsQ0FBQyxDQUFEOztRQUMxQyxJQUFHLGNBQWUsQ0FBQyxNQUFPLENBQUEsQ0FBQSxDQUFFLENBQTVCO1VBQ0UsT0FBUyxDQUFBLENBQUEsQ0FBRSxjQUFlLENBQUMsQ0FBRDtVQUMxQixTQUFXLENBQUEsQ0FBQSxDQUFFLFNBQVUsQ0FBQyxPQUFPLENBQUMsSUFBRCxDQUFSLENBQWUsQ0FBQyxRQUFRLFFBQU8sS0FBUjtVQUM5QyxRQUFVLENBQUEsQ0FBQSxDQUFHLE1BQUEsQ0FBQSxDQUFBLENBQWlELElBQWpELENBQXNELEdBQUEsQ0FBdEQ7QUFBQSxVQUFTLE1BQVQsQ0FBZ0IsQ0FBRSxVQUFsQixFQUErQixDQUFFLE9BQUYsQ0FBZixDQUFBLENBQWhCLENBQTJELENBQUEsQ0FBQSxDQUFDLFNBQUEsQ0FBQSxDQUFBLENBQVMsU0FBVSxDQUFBLENBQUEsQ0FBQzs7UUFDL0YsTUFBQSxDQUFPLFFBQVA7T0FmRztNQURKO01BbUJiLFdBQWEsQ0FBQSxDQUFBLENBQUUsS0FBQSxDQUFBLENBQUEsQ0FBTSxTQUFVLENBQUEsQ0FBQSxDQUFDO01BQ2hDLFVBQVksQ0FBQSxDQUFBLENBQUssVUFBVyxDQUFBLENBQUEsQ0FBQyxHQUFBLENBQUEsQ0FBQSxDQUFHLElBQUksQ0FBQSxDQUFBLENBQUM7TUFDckMsSUFBSSxRQUFBLENBQUEsQ0FBQSxDQUFTLFVBQWI7YUFDQSxFQUFHLENBQUMsY0FBZ0IsWUFBYSxhQUFjO1FBQUUsTUFBTTtNQUFSLENBQTNCO0tBdkJFO0lBQWI7SUFBWDs7V0EwQkEsSUFBeUIscUJBQUE7OztBQUU3QixjQUFrQixDQUFBLENBQUEsQ0FBRSxRQUFBLENBQUEsR0FBQSxFQUFBLFVBQUEsRUFBQSxNQUFBO0VBQ2xCLEdBQUksQ0FBQSxDQUFBLENBQUUsR0FBSSxDQUFBLEVBQUEsQ0FBRztFQUNiLFVBQVksQ0FBQSxDQUFBLENBQUUsVUFBWSxDQUFBLEVBQUEsQ0FBRztTQUU3QixPQUNFLFlBQ0EsUUFBQSxDQUFBLEdBQUE7SUFDRSxJQUFJLEdBQUo7YUFDRSxJQUFJLHFDQUFBLENBQUEsQ0FBQSxDQUFzQyxVQUExQztLQUNGO01BQ0UsSUFBSSw4QkFBQSxDQUFBLENBQUEsQ0FBK0IsVUFBbkM7TUFDQSxJQUFJLGdDQUFBLENBQUEsQ0FBQSxDQUFpQyxHQUFyQzthQUNBLFNBQVMsR0FBQSxDQUNQLENBQUMsS0FBSyxRQUFBLENBQUEsSUFBQTtlQUNKLFVBQVksSUFBSSxDQUFDLFNBQVEsR0FBRyxZQUFhLE1BQTlCO09BRFA7O0dBUlo7O0FBV0osSUFBSyxDQUFBLENBQUEsQ0FBRSxRQUFRLFVBQUQsRUFBYSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBRCxDQUFuQjtBQUUxQixVQUFZLENBQUEsQ0FBQSxDQUFFLElBQUksQ0FBQyxDQUFFLENBQUEsRUFBQSxDQUFHO0FBQ3hCLE1BQU8sQ0FBQSxDQUFBLENBQUUsSUFBSSxDQUFDLENBQUUsQ0FBQSxFQUFBLENBQUc7QUFDbkIsZUFBa0IsSUFBSSxDQUFDLEdBQUcsWUFBYSxNQUFyQiIsInNvdXJjZXNDb250ZW50IjpbImBgIyEvdXNyL2Jpbi9lbnYgbm9kZWBgXG5cbnsgcmVqZWN0LCBlYWNoLCBrZXlzLCBtYXAsIGVsZW0taW5kZXgsIGZpbmQtaW5kZXgsIGpvaW4sIGlzLXR5cGUsIGNvbXBhY3QsIGNvbmNhdCB9ID0gcmVxdWlyZSAncHJlbHVkZS1scydcbnsgbmFtZSwgdmVyc2lvbiB9ID0gcmVxdWlyZSAnLi4vcGFja2FnZSdcbmZzID0gcmVxdWlyZSAnZnMnXG5kb3dubG9hZCA9IHJlcXVpcmUgJ2Rvd25sb2FkJ1xuZG93bmxvYWQtc3RhdHVzID0gcmVxdWlyZSAnZG93bmxvYWQtc3RhdHVzJ1xubWtkaXJwID0gcmVxdWlyZSAnbWtkaXJwJ1xuXG5tc2cgPSAobSkgLT4gY29uc29sZS5sb2cgXCIje25hbWV9ICgje3ZlcnNpb259KTogI3ttfVwiXG5cbnRzdi10by1pMThuID0gKHJhdy10ZXh0LCBkZXN0LWZvbGRlciwgZm9ybWF0KSAtPlxuICBbIGhlYWRlciwgLi4ubGluZXMgXSA9IHJhdy10ZXh0LnRvU3RyaW5nIXNwbGl0ICdcXHJcXG4nXG4gIGxvY2FsZXMgPSB7fSAjIGUuZy4geydlbic6MywgJ3poJzo0fVxuICBoZWFkZXItaXRlbXMgPSBoZWFkZXIuc3BsaXQgJ1xcdCdcbiAgaGVhZGVyLWl0ZW1zIHw+IGVhY2ggLT5cbiAgICBpZiAoaXQgbm90IGluIFsgJycgJyMnICdyZW1hcmsnXSlcbiAgICAgIGxvY2FsZXNbaXRdID0gZWxlbS1pbmRleCBpdCwgaGVhZGVyLWl0ZW1zXG5cblxuICBzd2l0Y2hcbiAgY2FzZSBmb3JtYXQgaW4gWyd5YW1sJywgJ3ltbCddXG4gICAgbXNnIFwiR2VuZXJhdGluZyAje2Zvcm1hdH0gZmlsZXMgLi4uXCJcbiAgICBsb2NhbGVzIHw+IGtleXMgfD4gZWFjaCAobGFuZyktPlxuICAgICAgeWFtbC1saW5lcyA9IGxpbmVzXG4gICAgICAgICAgICAgICAgfD4gbWFwIChsaW5lKS0+XG4gICAgICAgICAgICAgICAgICAgIGxpbmUtaXRlbXMgPSBsaW5lLnNwbGl0ICdcXHQnXG4gICAgICAgICAgICAgICAgICAgICMgZmluZCAxc3Qgbm9uLWVtcHR5IGNvbHVtbiBvZiB0aGUgbGluZS5cbiAgICAgICAgICAgICAgICAgICAgIyB3aGljaCBpcyB0aGUga2V5LWluZGV4IG9mIHRoZSBjb3JyZXNwb25kaW5nIHlhbWwgbGluZVxuICAgICAgICAgICAgICAgICAgICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgICAgICAgICAgICAgICAgICAgdW5sZXNzIGlzLXR5cGUgJ1VuZGVmaW5lZCcsIGtleS1pbmRleFxuICAgICAgICAgICAgICAgICAgICAgIGluZGVudC1uLWtleSA9IFwiI3snICAnICoga2V5LWluZGV4fSN7bGluZS1pdGVtc1trZXktaW5kZXhdfVwiXG4gICAgICAgICAgICAgICAgICAgICAgIyB2YWx1ZSA9IGxpbmUtaXRlbXNbbG9jYWxlc1tsYW5nXV0ucmVwbGFjZSgvXFxcIi9naSwnXFxcXFxcXCInKVxuICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbGluZS1pdGVtc1tsb2NhbGVzW2xhbmddXVxuICAgICAgICAgICAgICAgICAgICAgIGlmIC9eW1xce1xcW10vLnRlc3QodmFsdWUpICMgaGFuZGxlcyB2YWx1ZSBzdGFydGluZyB3aXRoIHNwZWNpYWwgeWFtbCBjaGFyYWN0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gXCInI3t2YWx1ZX0nXCIgIyBhZGQgc2luZ2xlIHF1b3RlXG4gICAgICAgICAgICAgICAgICAgICAgbGluZSA9IFwiI3tpbmRlbnQtbi1rZXl9OlwiICsgKGlmIHZhbHVlIHRoZW4gXCIgI3t2YWx1ZX1cIiBlbHNlICcnKVxuICAgICAgICAgICAgICAgIHw+IGpvaW4gJ1xcbidcbiAgICAgIG91dHB1dC1maWxlID0gXCIje2Rlc3QtZm9sZGVyfS8je2xhbmd9LmkxOG4ueW1sXCJcbiAgICAgIG1zZyBcIlxcdCAtPiAje291dHB1dC1maWxlfVwiXG4gICAgICBmcyAud3JpdGVGaWxlU3luYyBvdXRwdXQtZmlsZSwgeWFtbC1saW5lcywgeyBmbGFnOiAndyd9XG5cbiAgY2FzZSBmb3JtYXQgaW4gWydqc29uJ11cbiAgICBtc2cgXCJHZW5lcmF0aW5nICN7Zm9ybWF0fSBmaWxlcyAuLi5cIlxuICAgIHByZWZpeC1rZXlzID0gW11cbiAgICBsb2NhbGVzIHw+IGtleXMgfD4gZWFjaCAobGFuZyktPlxuICAgICAganNvbi1saW5lcyA9IGxpbmVzXG4gICAgICAgICAgICAgICAgfD4gbWFwIChsaW5lKS0+XG4gICAgICAgICAgICAgICAgICAgIGpzb24tbGluZSA9ICcnXG4gICAgICAgICAgICAgICAgICAgIGxpbmUtaXRlbXMgPSBsaW5lLnNwbGl0ICdcXHQnXG4gICAgICAgICAgICAgICAgICAgICMgZmluZCAxc3Qgbm9uLWVtcHR5IGNvbHVtbiBvZiB0aGUgbGluZS5cbiAgICAgICAgICAgICAgICAgICAgIyB3aGljaCBpcyB0aGUga2V5LWluZGV4IG9mIHRoZSBjb3JyZXNwb25kaW5nIHlhbWwgbGluZVxuICAgICAgICAgICAgICAgICAgICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgICAgICAgICAgICAgICAgICAgY29tcGFjdGVkLWl0ZW1zID0gY29tcGFjdChsaW5lLWl0ZW1zKVxuICAgICAgICAgICAgICAgICAgICBpZiBrZXktaW5kZXggPT0gMCAjIHRvcCBsZXZlbCBrZXlcbiAgICAgICAgICAgICAgICAgICAgICBwcmVmaXgta2V5cyA6PSBbXSAjIHJlc2V0IHByZWZpeC1rZXlzIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIGlmIGNvbXBhY3RlZC1pdGVtcy5sZW5ndGggPT0gMSAjIGxpbmUgd2l0aCBvbmx5IG9uZSBwcmVmaXgta2V5XG4gICAgICAgICAgICAgICAgICAgICAgcHJlZml4LWtleXNba2V5LWluZGV4XSA9IGNvbXBhY3RlZC1pdGVtc1swXSAjIHJlcGxhY2UgcHJlZml4LWtleXNcbiAgICAgICAgICAgICAgICAgICAgaWYgY29tcGFjdGVkLWl0ZW1zLmxlbmd0aCA+IDEgIyBsaW5lIGNvbnRhaW5pbmcgbGVhdmUgbGV2ZWwga2V5IGFuZCBsYW5nIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy1rZXkgPSBjb21wYWN0ZWQtaXRlbXNbMF1cbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLXZhbHVlID0gbGluZS1pdGVtc1tsb2NhbGVzW2xhbmddXS5yZXBsYWNlKC9cXFwiL2dpLCdcXFxcXFxcIicpICMgZXNjYXBlIGRvdWJsZSBxdW90ZSAnXCInXG4gICAgICAgICAgICAgICAgICAgICAganNvbi1saW5lIDo9IFwiICBcXFwiI3soIGNvbmNhdCBbIHByZWZpeC1rZXlzLCBbIHRoaXMta2V5IF0gXSB8PiBqb2luICcuJyApfVxcXCIgOiBcXFwiI3t0aGlzLXZhbHVlfVxcXCJcIlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ganNvbi1saW5lXG4gICAgICAgICAgICAgICAgfD4gcmVqZWN0IC0+IGl0ID09ICcnICMgcmVtb3ZlIGVtcHR5IGxpbmVzXG4gICAgICAgICAgICAgICAgfD4gam9pbiAnLFxcbidcbiAgICAgIGpzb24tY29udGVudCA9IFwie1xcbiN7anNvbi1saW5lc31cXG59XCJcbiAgICAgIG91dHB1dC1maWxlID0gXCIje2Rlc3QtZm9sZGVyfS8je2xhbmd9Lmpzb25cIlxuICAgICAgbXNnIFwiXFx0IC0+ICN7b3V0cHV0LWZpbGV9XCJcbiAgICAgIGZzIC53cml0ZS1maWxlLXN5bmMgb3V0cHV0LWZpbGUsIGpzb24tY29udGVudCwgeyBmbGFnOiAndyd9XG5cbiAgZGVmYXVsdFxuICAgIG1zZyBcIlVuc3VwcG9ydGVkIGZvcm1hdCFcIlxuXG5nZW4taTE4bi1mcm9tLXVybCA9ICh1cmwsIGRlc3QtZm9sZGVyLCBmb3JtYXQpLT5cbiAgdXJsID0gdXJsIHx8ICcnXG4gIGRlc3QtZm9sZGVyID0gZGVzdC1mb2xkZXIgfHwgJy4nXG4gICMgbWFrZSBzdXJlIGRlc3QtZm9sZGVyIGV4aXN0c1xuICBta2RpcnAgZG9cbiAgICBkZXN0LWZvbGRlclxuICAgIChlcnIpLT5cbiAgICAgIGlmIChlcnIpXG4gICAgICAgIG1zZyBcIkVycm9yIGNyZWF0aW5nIGRlc3RpbmF0aW9uIGZvbGRlcjogI3tkZXN0LWZvbGRlcn1cIlxuICAgICAgZWxzZVxuICAgICAgICBtc2cgXCJDcmVhdGVkIGRlc3RpbmF0aW9uIGZvbGRlcjogI3tkZXN0LWZvbGRlcn1cIlxuICAgICAgICBtc2cgXCJHZXR0aW5nIHNvdXJjZSBUU1YgZmlsZSBmcm9tOiAje3VybH1cIlxuICAgICAgICBkb3dubG9hZCB1cmxcbiAgICAgICAgICAudGhlbiAoZGF0YSktPlxuICAgICAgICAgICAgdHN2LXRvLWkxOG4oZGF0YS50b1N0cmluZyEsIGRlc3QtZm9sZGVyLCBmb3JtYXQpXG5cbmFyZ3YgPSByZXF1aXJlKCdtaW5pbWlzdCcpKHByb2Nlc3MuYXJndi5zbGljZSgyKSlcbiMgbXNnIEpTT04uc3RyaW5naWZ5IGFyZ3ZcbmRlc3QtZm9sZGVyID0gYXJndi5wIHx8ICcuJ1xuZm9ybWF0ID0gYXJndi5mIHx8ICd5bWwnICMgJ3ltbCcgKGRlZmF1bHQpIG9yICdqc29uJ1xuZ2VuLWkxOG4tZnJvbS11cmwgYXJndi5zLCBkZXN0LWZvbGRlciwgZm9ybWF0XG4iXX0=
