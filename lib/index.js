#!/usr/bin/env node
var ref$, reject, each, keys, map, elemIndex, findIndex, join, isType, compact, concat, srcTsv, version, msg, fs, download, downloadStatus, mkdirp, tsvToI18nYamls, genI18nYamlsFromUrl, argv, destFolder, slice$ = [].slice;
ref$ = require('prelude-ls'), reject = ref$.reject, each = ref$.each, keys = ref$.keys, map = ref$.map, elemIndex = ref$.elemIndex, findIndex = ref$.findIndex, join = ref$.join, isType = ref$.isType, compact = ref$.compact, concat = ref$.concat;
if (process.argv.length > 2) {
  srcTsv = process.argv[2];
}
version = '0.3.5';
msg = function(m){
  return console.log("i18n-gen (" + version + "): " + m);
};
fs = require('fs');
download = require('download');
downloadStatus = require('download-status');
mkdirp = require('mkdirp');
tsvToI18nYamls = function(rawText, destFolder){
  var ref$, header, lines, locales, headerItems;
  ref$ = rawText.toString().split('\r\n'), header = ref$[0], lines = slice$.call(ref$, 1);
  locales = {};
  headerItems = header.split('\t');
  each(function(it){
    if (it !== '' && it !== '#' && it !== 'remark') {
      return locales[it] = elemIndex(it, headerItems);
    }
  })(
  headerItems);
  msg("Generating .yml files ...");
  return each(function(lang){
    var yamlLines, outputFile;
    yamlLines = join('\n')(
    map(function(line){
      var lineItems, keyIndex, indentNKey;
      lineItems = line.split('\t');
      keyIndex = findIndex(function(it){
        return it !== '';
      })(
      lineItems);
      if (!isType('Undefined', keyIndex)) {
        indentNKey = repeatString$('  ', keyIndex) + "" + lineItems[keyIndex];
        return line = indentNKey + ": \"" + lineItems[locales[lang]] + "\"";
      }
    })(
    lines));
    outputFile = destFolder + "/" + lang + ".i18n.yml";
    msg("\t -> " + outputFile);
    return fs.writeFileSync(outputFile, yamlLines, {
      flag: 'w'
    });
  })(
  keys(
  locales));
};
genI18nYamlsFromUrl = function(url, destFolder){
  url = url || '';
  destFolder = destFolder || '.';
  return mkdirp(destFolder, function(err){
    if (err) {
      return msg("Error creating destination folder: " + destFolder);
    } else {
      msg("Created destination folder: " + destFolder);
      msg("Getting .tsv from: " + url + ". Target folder: " + destFolder);
      return download(url).then(function(data){
        return tsvToI18nYamls(data.toString(), destFolder);
      });
    }
  });
};
argv = require('minimist')(process.argv.slice(2));
msg(JSON.stringify(argv));
destFolder = argv.p || '.';
genI18nYamlsFromUrl(argv.s, destFolder);
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9pbmRleC5scyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLElBQUEsR0FBc0YsT0FBdEYsQ0FBOEYsWUFBQSxDQUE5RixFQUFFLE1BQWtGLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQUUsTUFBRixFQUFVLElBQTBFLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQVUsSUFBVixFQUFnQixJQUFvRSxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFnQixJQUFoQixFQUFzQixHQUE4RCxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFzQixHQUF0QixFQUEyQixTQUF5RCxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUEyQixTQUEzQixFQUF1QyxTQUE2QyxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUF1QyxTQUF2QyxFQUFtRCxJQUFpQyxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFtRCxJQUFuRCxFQUF5RCxNQUEyQixDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUF5RCxNQUF6RCxFQUFrRSxPQUFrQixDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFrRSxPQUFsRSxFQUEyRSxNQUFTLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQTJFO0FBQzNFLElBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFPLENBQUEsQ0FBQSxDQUFFLENBQXpCO0VBQ0UsTUFBUSxDQUFBLENBQUEsQ0FBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUQ7O0FBRXhCLE9BQVEsQ0FBQSxDQUFBLENBQUU7QUFDVixHQUFJLENBQUEsQ0FBQSxDQUFFLFFBQUEsQ0FBQSxDQUFBO1NBQU8sT0FBTyxDQUFDLElBQUksWUFBQSxDQUFBLENBQUEsQ0FBYSxPQUFPLENBQUEsQ0FBQSxDQUFDLEtBQUEsQ0FBQSxDQUFBLENBQUssQ0FBOUI7O0FBQ3JCLEVBQUcsQ0FBQSxDQUFBLENBQUUsUUFBUSxJQUFBO0FBQ2IsUUFBUyxDQUFBLENBQUEsQ0FBRSxRQUFRLFVBQUE7QUFDbkIsY0FBZ0IsQ0FBQSxDQUFBLENBQUUsUUFBUSxpQkFBQTtBQUMxQixNQUFPLENBQUEsQ0FBQSxDQUFFLFFBQVEsUUFBQTtBQUVqQixjQUFrQixDQUFBLENBQUEsQ0FBRSxRQUFBLENBQUEsT0FBQSxFQUFBLFVBQUE7O0VBQ2xCLElBQUEsR0FBdUIsT0FBUSxDQUFDLFFBQWhDLENBQXdDLENBQUMsQ0FBQSxLQUF6QyxDQUErQyxNQUFBLENBQS9DLEVBQUUsTUFBbUIsQ0FBQSxDQUFBLENBQXJCLElBQUEsQ0FBQSxDQUFBLENBQUEsRUFBYSxLQUFRLENBQUEsQ0FBQSxDQUFyQjtFQUNBLE9BQVEsQ0FBQSxDQUFBLENBQUU7RUFDVixXQUFhLENBQUEsQ0FBQSxDQUFFLE1BQU0sQ0FBQyxNQUFNLElBQUE7RUFDWixLQUFLLFFBQUEsQ0FBQSxFQUFBO0lBQ25CLElBQUksRUFBQSxLQUFZLEVBQVosSUFBQSxFQUFBLEtBQWUsR0FBZixJQUFBLEVBQUEsS0FBbUIsUUFBdkI7YUFDRSxPQUFPLENBQUMsRUFBRCxDQUFLLENBQUEsQ0FBQSxDQUFFLFVBQVcsSUFBSSxXQUFKOztHQUZSO0VBQXJCO0VBSUEsSUFBK0IsMkJBQUE7U0FFWixLQUFLLFFBQUEsQ0FBQSxJQUFBOztJQUN0QixTQUFXLENBQUEsQ0FBQSxDQVNFLEtBQUssSUFBQTtJQVJMLElBQUksUUFBQSxDQUFBLElBQUE7O01BQ0gsU0FBVyxDQUFBLENBQUEsQ0FBRSxJQUFJLENBQUMsTUFBTSxJQUFBO01BR3hCLFFBQVUsQ0FBQSxDQUFBLENBQWdCLFVBQVcsUUFBQSxDQUFBLEVBQUE7ZUFBRyxFQUFHLENBQUEsR0FBQSxDQUFHO09BQVQ7TUFBekI7TUFDWixJQUFBLENBQU8sTUFBUCxDQUFlLFdBQWYsRUFBNEIsUUFBYixDQUFmO1FBQ0UsVUFBYSxDQUFBLENBQUEsQ0FBVSxhQUFBLENBQUwsSUFBSyxFQUFFLFFBQUYsQ0FBVyxDQUFBLENBQUEsQ0FBQyxFQUFBLENBQUEsQ0FBQSxDQUFFLFNBQVUsQ0FBQyxRQUFEO2VBQy9DLElBQUssQ0FBQSxDQUFBLENBQUssVUFBWSxDQUFBLENBQUEsQ0FBQyxNQUFBLENBQUEsQ0FBQSxDQUFNLFNBQVUsQ0FBQyxPQUFPLENBQUMsSUFBRCxDQUFSLENBQWUsQ0FBQSxDQUFBLENBQUM7O0tBUHREO0lBREo7SUFVYixVQUFZLENBQUEsQ0FBQSxDQUFLLFVBQVcsQ0FBQSxDQUFBLENBQUMsR0FBQSxDQUFBLENBQUEsQ0FBRyxJQUFJLENBQUEsQ0FBQSxDQUFDO0lBQ3JDLElBQUksUUFBQSxDQUFBLENBQUEsQ0FBUyxVQUFiO1dBQ0EsRUFBRyxDQUFDLGNBQWMsWUFBYSxXQUFZO01BQUUsTUFBTTtJQUFSLENBQXpCO0dBYkk7RUFBYjtFQUFYOztBQTBDRixtQkFBd0IsQ0FBQSxDQUFBLENBQUUsUUFBQSxDQUFBLEdBQUEsRUFBQSxVQUFBO0VBQ3hCLEdBQUksQ0FBQSxDQUFBLENBQUUsR0FBSSxDQUFBLEVBQUEsQ0FBRztFQUNiLFVBQVksQ0FBQSxDQUFBLENBQUUsVUFBWSxDQUFBLEVBQUEsQ0FBRztTQUU3QixPQUNFLFlBQ0EsUUFBQSxDQUFBLEdBQUE7SUFDRSxJQUFJLEdBQUo7YUFDRSxJQUFJLHFDQUFBLENBQUEsQ0FBQSxDQUFzQyxVQUExQztLQUNGO01BQ0UsSUFBSSw4QkFBQSxDQUFBLENBQUEsQ0FBK0IsVUFBbkM7TUFDQSxJQUFJLHFCQUFBLENBQUEsQ0FBQSxDQUFzQixHQUFHLENBQUEsQ0FBQSxDQUFDLG1CQUFBLENBQUEsQ0FBQSxDQUFtQixVQUFqRDthQUNBLFNBQVMsR0FBQSxDQUNQLENBQUMsS0FBSyxRQUFBLENBQUEsSUFBQTtlQUNKLGVBQWtCLElBQUksQ0FBQyxTQUFRLEdBQUcsVUFBakI7T0FEYjs7R0FSWjs7QUFXSixJQUFLLENBQUEsQ0FBQSxDQUFFLFFBQVEsVUFBRCxFQUFhLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFELENBQW5CO0FBQzFCLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBQSxDQUFmO0FBQ0osVUFBWSxDQUFBLENBQUEsQ0FBRSxJQUFJLENBQUMsQ0FBRSxDQUFBLEVBQUEsQ0FBRztBQUN4QixvQkFBd0IsSUFBSSxDQUFDLEdBQUcsVUFBUiIsInNvdXJjZXNDb250ZW50IjpbImBgIyEvdXNyL2Jpbi9lbnYgbm9kZWBgXG5cbnsgcmVqZWN0LCBlYWNoLCBrZXlzLCBtYXAsIGVsZW0taW5kZXgsIGZpbmQtaW5kZXgsIGpvaW4sIGlzLXR5cGUsIGNvbXBhY3QsIGNvbmNhdCB9ID0gcmVxdWlyZSAncHJlbHVkZS1scydcbmlmIHByb2Nlc3MuYXJndi5sZW5ndGggPiAyXG4gIHNyYy10c3YgPSBwcm9jZXNzLmFyZ3YuMlxuXG52ZXJzaW9uID0gJzAuMy41J1xubXNnID0gKG0pIC0+IGNvbnNvbGUubG9nIFwiaTE4bi1nZW4gKCN7dmVyc2lvbn0pOiAje219XCJcbmZzID0gcmVxdWlyZSAnZnMnXG5kb3dubG9hZCA9IHJlcXVpcmUgJ2Rvd25sb2FkJ1xuZG93bmxvYWQtc3RhdHVzID0gcmVxdWlyZSAnZG93bmxvYWQtc3RhdHVzJ1xubWtkaXJwID0gcmVxdWlyZSAnbWtkaXJwJ1xuXG50c3YtdG8taTE4bi15YW1scyA9IChyYXctdGV4dCwgZGVzdC1mb2xkZXIpIC0+XG4gIFsgaGVhZGVyLCAuLi5saW5lcyBdID0gcmF3LXRleHQudG9TdHJpbmchc3BsaXQgJ1xcclxcbidcbiAgbG9jYWxlcyA9IHt9ICMgZS5nLiB7J2VuJzozLCAnemgnOjR9XG4gIGhlYWRlci1pdGVtcyA9IGhlYWRlci5zcGxpdCAnXFx0J1xuICBoZWFkZXItaXRlbXMgfD4gZWFjaCAtPlxuICAgIGlmIChpdCBub3QgaW4gWyAnJyAnIycgJ3JlbWFyayddKVxuICAgICAgbG9jYWxlc1tpdF0gPSBlbGVtLWluZGV4IGl0LCBoZWFkZXItaXRlbXNcblxuICBtc2cgXCJHZW5lcmF0aW5nIC55bWwgZmlsZXMgLi4uXCJcblxuICBsb2NhbGVzIHw+IGtleXMgfD4gZWFjaCAobGFuZyktPlxuICAgIHlhbWwtbGluZXMgPSBsaW5lc1xuICAgICAgICAgICAgICB8PiBtYXAgKGxpbmUpLT5cbiAgICAgICAgICAgICAgICAgIGxpbmUtaXRlbXMgPSBsaW5lLnNwbGl0ICdcXHQnXG4gICAgICAgICAgICAgICAgICAjIGZpbmQgMXN0IG5vbi1lbXB0eSBjb2x1bW4gb2YgdGhlIGxpbmUuXG4gICAgICAgICAgICAgICAgICAjIHdoaWNoIGlzIHRoZSBrZXktaW5kZXggb2YgdGhlIGNvcnJlc3BvbmRpbmcgeWFtbCBsaW5lXG4gICAgICAgICAgICAgICAgICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgICAgICAgICAgICAgICAgIHVubGVzcyBpcy10eXBlICdVbmRlZmluZWQnLCBrZXktaW5kZXhcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50LW4ta2V5ID0gXCIjeycgICcgKiBrZXktaW5kZXh9I3tsaW5lLWl0ZW1zW2tleS1pbmRleF19XCJcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9IFwiI3tpbmRlbnQtbi1rZXl9OiBcXFwiI3tsaW5lLWl0ZW1zW2xvY2FsZXNbbGFuZ11dfVxcXCJcIlxuICAgICAgICAgICAgICB8PiBqb2luICdcXG4nXG4gICAgb3V0cHV0LWZpbGUgPSBcIiN7ZGVzdC1mb2xkZXJ9LyN7bGFuZ30uaTE4bi55bWxcIlxuICAgIG1zZyBcIlxcdCAtPiAje291dHB1dC1maWxlfVwiXG4gICAgZnMgLndyaXRlRmlsZVN5bmMgb3V0cHV0LWZpbGUsIHlhbWwtbGluZXMsIHsgZmxhZzogJ3cnfVxuXG4gICMgbXNnIFwiR2VuZXJhdGluZyAuanNvbiBmaWxlcyAuLi5cIlxuICAjIHByZWZpeC1rZXlzID0gW11cbiAgIyBsb2NhbGVzIHw+IGtleXMgfD4gZWFjaCAobGFuZyktPlxuICAjICAganNvbi1saW5lcyA9IGxpbmVzXG4gICMgICAgICAgICAgICAgfD4gbWFwIChsaW5lKS0+XG4gICMgICAgICAgICAgICAgICAgIGpzb24tbGluZSA9ICcnXG4gICMgICAgICAgICAgICAgICAgIGxpbmUtaXRlbXMgPSBsaW5lLnNwbGl0ICdcXHQnXG4gICMgICAgICAgICAgICAgICAgICMgZmluZCAxc3Qgbm9uLWVtcHR5IGNvbHVtbiBvZiB0aGUgbGluZS5cbiAgIyAgICAgICAgICAgICAgICAgIyB3aGljaCBpcyB0aGUga2V5LWluZGV4IG9mIHRoZSBjb3JyZXNwb25kaW5nIHlhbWwgbGluZVxuICAjICAgICAgICAgICAgICAgICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgIyAgICAgICAgICAgICAgICAgY29tcGFjdGVkLWl0ZW1zID0gY29tcGFjdChsaW5lLWl0ZW1zKVxuICAjICAgICAgICAgICAgICAgICBpZiBrZXktaW5kZXggPT0gMCAjIHRvcCBsZXZlbCBrZXlcbiAgIyAgICAgICAgICAgICAgICAgICBwcmVmaXgta2V5cyA6PSBbXSAjIHJlc2V0IHByZWZpeC1rZXlzIGFycmF5XG4gICMgICAgICAgICAgICAgICAgIGlmIGNvbXBhY3RlZC1pdGVtcy5sZW5ndGggPT0gMSAjIGxpbmUgd2l0aCBvbmx5IG9uZSBwcmVmaXgta2V5XG4gICMgICAgICAgICAgICAgICAgICAgcHJlZml4LWtleXNba2V5LWluZGV4XSA9IGNvbXBhY3RlZC1pdGVtc1swXSAjIHJlcGxhY2UgcHJlZml4LWtleXNcbiAgIyAgICAgICAgICAgICAgICAgaWYgY29tcGFjdGVkLWl0ZW1zLmxlbmd0aCA+IDEgIyBsaW5lIGNvbnRhaW5pbmcgYm90dG9tIGxldmVsIGtleSBhbmQgbGFuZyB2YWx1ZVxuICAjICAgICAgICAgICAgICAgICAgIHRoaXMta2V5ID0gY29tcGFjdGVkLWl0ZW1zWzBdXG4gICMgICAgICAgICAgICAgICAgICAgdGhpcy12YWx1ZSA9IGxpbmUtaXRlbXNbbG9jYWxlc1tsYW5nXV0ucmVwbGFjZSgvXFxcIi9naSwnXFxcXFxcXCInKSAjIGVzY2FwZSBkb3VibGUgcXVvdGUgJ1wiJ1xuICAjICAgICAgICAgICAgICAgICAgIGpzb24tbGluZSA6PSBcIiAgXFxcIiN7KCBjb25jYXQgWyBwcmVmaXgta2V5cywgWyB0aGlzLWtleSBdIF0gfD4gam9pbiAnLicgKX1cXFwiIDogXFxcIiN7dGhpcy12YWx1ZX1cXFwiXCJcbiAgIyAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb24tbGluZVxuICAjICAgICAgICAgICAgIHw+IHJlamVjdCAtPiBpdCA9PSAnJyAjIHJlbW92ZSBlbXB0eSBsaW5lc1xuICAjICAgICAgICAgICAgIHw+IGpvaW4gJyxcXG4nXG4gICMgICBqc29uLWNvbnRlbnQgPSBcIntcXG4je2pzb24tbGluZXN9XFxufVwiXG4gICMgICBvdXRwdXQtZmlsZSA9IFwiI3tkZXN0LWZvbGRlcn0vI3tsYW5nfS5qc29uXCJcbiAgIyAgIG1zZyBcIlxcdCAtPiAje291dHB1dC1maWxlfVwiXG4gICMgICBmcyAud3JpdGUtZmlsZS1zeW5jIG91dHB1dC1maWxlLCBqc29uLWNvbnRlbnQsIHsgZmxhZzogJ3cnfVxuXG5nZW4taTE4bi15YW1scy1mcm9tLXVybCA9ICh1cmwsIGRlc3QtZm9sZGVyKS0+XG4gIHVybCA9IHVybCB8fCAnJ1xuICBkZXN0LWZvbGRlciA9IGRlc3QtZm9sZGVyIHx8ICcuJ1xuICAjIG1ha2Ugc3VyZSBkZXN0LWZvbGRlciBleGlzdHNcbiAgbWtkaXJwIGRvXG4gICAgZGVzdC1mb2xkZXJcbiAgICAoZXJyKS0+XG4gICAgICBpZiAoZXJyKVxuICAgICAgICBtc2cgXCJFcnJvciBjcmVhdGluZyBkZXN0aW5hdGlvbiBmb2xkZXI6ICN7ZGVzdC1mb2xkZXJ9XCJcbiAgICAgIGVsc2VcbiAgICAgICAgbXNnIFwiQ3JlYXRlZCBkZXN0aW5hdGlvbiBmb2xkZXI6ICN7ZGVzdC1mb2xkZXJ9XCJcbiAgICAgICAgbXNnIFwiR2V0dGluZyAudHN2IGZyb206ICN7dXJsfS4gVGFyZ2V0IGZvbGRlcjogI3tkZXN0LWZvbGRlcn1cIlxuICAgICAgICBkb3dubG9hZCB1cmxcbiAgICAgICAgICAudGhlbiAoZGF0YSktPlxuICAgICAgICAgICAgdHN2LXRvLWkxOG4teWFtbHMoZGF0YS50b1N0cmluZyEsIGRlc3QtZm9sZGVyKVxuXG5hcmd2ID0gcmVxdWlyZSgnbWluaW1pc3QnKShwcm9jZXNzLmFyZ3Yuc2xpY2UoMikpXG5tc2cgSlNPTi5zdHJpbmdpZnkgYXJndlxuZGVzdC1mb2xkZXIgPSBhcmd2LnAgfHwgJy4nXG5nZW4taTE4bi15YW1scy1mcm9tLXVybCBhcmd2LnMsIGRlc3QtZm9sZGVyXG4iXX0=
