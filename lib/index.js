#!/usr/bin/env node
var ref$, reject, each, keys, map, elemIndex, findIndex, join, isType, compact, concat, range, name, version, fs, download, mkdirp, xlsxToJson, Excel, msg, excelSampleFile, wb, composeYamlLine, dataToI18n, genI18nFromSrc, argv, destFolder, format, slice$ = [].slice;
ref$ = require('prelude-ls'), reject = ref$.reject, each = ref$.each, keys = ref$.keys, map = ref$.map, elemIndex = ref$.elemIndex, findIndex = ref$.findIndex, join = ref$.join, isType = ref$.isType, compact = ref$.compact, concat = ref$.concat;
range = require('lodash').range;
ref$ = require('../package'), name = ref$.name, version = ref$.version;
fs = require('fs');
download = require('download');
mkdirp = require('mkdirp');
xlsxToJson = require('node-excel-to-json');
Excel = require('exceljs');
msg = function(m){
  return console.log(name + " (" + version + "): " + m);
};
excelSampleFile = './test/data-source/i18n-gen-sample-source.xlsx';
wb = new Excel.Workbook();
wb.xlsx.readFile(excelSampleFile).then(function(){
  var ws, result;
  ws = wb.getWorksheet(1);
  result = range(1, ws.actualRowCount + 1).map(function(i){
    return ws.getRow(i)._cells.splice(0, ws.actualColumnCount).map(function(c){
      return c.value;
    });
  });
  return console.log(result);
});
composeYamlLine = function(lineItems, valCol){
  var keyIndex, indentNKey, value, line;
  keyIndex = findIndex(function(it){
    return it !== '';
  })(
  lineItems);
  if (!isType('Undefined', keyIndex)) {
    indentNKey = repeatString$('  ', keyIndex) + "" + lineItems[keyIndex];
    value = lineItems[valCol];
    if (/^[\{\[]/.test(value)) {
      value = "'" + value + "'";
    }
    return line = (indentNKey + ":") + (value ? " " + value : '');
  }
};
dataToI18n = function(rawRows, destFolder, format){
  var header, rows, locales, headerItems, prefixKeys;
  header = rawRows[0], rows = slice$.call(rawRows, 1);
  locales = {};
  headerItems = header;
  each(function(it){
    if (it !== '' && it !== '#' && it !== 'remark') {
      return locales[it] = elemIndex(it, headerItems);
    }
  })(
  headerItems);
  switch (false) {
  case format !== 'yaml' && format !== 'yml':
    msg("Generating " + format + " files ...");
    return each(function(lang){
      var yamlRows, outFilePath;
      yamlRows = join('\n')(
      map(function(line){
        return composeYamlLine(line, locales[lang]);
      })(
      rows));
      outFilePath = destFolder + "/" + lang + ".i18n.yml";
      msg("\t -> " + outFilePath);
      return fs.writeFileSync(outFilePath, yamlRows, {
        flag: 'w'
      });
    })(
    keys(
    locales));
  case !in$(format, ['json']):
    msg("Generating " + format + " files ...");
    prefixKeys = [];
    return each(function(lang){
      var jsonRows, jsonContent, outFilePath;
      jsonRows = join(',\n')(
      reject(function(it){
        return it === '';
      })(
      map(function(line){
        var jsonLine, lineItems, keyIndex, compactedItems, thisKey, thisValue;
        jsonLine = '';
        lineItems = line;
        keyIndex = findIndex(function(it){
          return it !== '';
        })(
        lineItems);
        compactedItems = compact(lineItems);
        if (keyIndex === 0) {
          prefixKeys = [];
        }
        if (compactedItems.length === 1) {
          prefixKeys[keyIndex] = compactedItems[0];
        }
        if (compactedItems.length > 1) {
          thisKey = compactedItems[0];
          thisValue = lineItems[locales[lang]].replace(/\"/gi, '\\"');
          jsonLine = "  \"" + join('.')(
          concat([prefixKeys, [thisKey]])) + "\" : \"" + thisValue + "\"";
        }
        return jsonLine;
      })(
      rows)));
      jsonContent = "{\n" + jsonRows + "\n}";
      outFilePath = destFolder + "/" + lang + ".json";
      msg("\t -> " + outFilePath);
      return fs.writeFileSync(outFilePath, jsonContent, {
        flag: 'w'
      });
    })(
    keys(
    locales));
  default:
    return msg("Unsupported format!");
  }
};
genI18nFromSrc = function(src, destFolder, format){
  src = src || '';
  destFolder = destFolder || '.';
  if (!src.trim()) {
    msg("No data source specified");
    return;
  }
  return mkdirp(destFolder.trim(), function(err){
    if (err) {
      return msg("Error creating destination folder: " + destFolder);
    } else {
      msg("Created destination folder: " + destFolder);
      if (/^http/.test(src.toLowerCase())) {
        msg("Using remote i18n source: " + src);
        return download(src).then(function(data){
          var rawDataTable;
          rawDataTable = data.toString().split('\r\n').map(function(line){
            return line.split('\t');
          });
          return dataToI18n(rawDataTable, destFolder, format);
        });
      } else {
        return msg("Using local i18n source: " + src);
      }
    }
  });
};
argv = require('minimist')(process.argv.slice(2));
destFolder = argv.p || '.';
format = argv.f || 'yml';
genI18nFromSrc(argv.s, destFolder, format);
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}
//# sourceMappingURL=data:application/json;base64,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VUFBbkM7TUFDQSxJQUFHLE9BQU8sQ0FBQyxJQUFYLENBQWdCLEdBQUcsQ0FBQyxXQUFwQixDQUFpQyxDQUFqQixDQUFoQjtRQUNFLElBQUksNEJBQUEsQ0FBQSxDQUFBLENBQTZCLEdBQWpDO2VBQ0EsU0FBUyxHQUFBLENBQ1AsQ0FBQyxLQUFLLFFBQUEsQ0FBQSxJQUFBOztVQUVKLFlBQWUsQ0FBQSxDQUFBLENBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBLE1BQU0sTUFBRCxDQUNqQixDQUFDLElBQUksUUFBQSxDQUFBLElBQUE7bUJBQVUsSUFBSSxDQUFDLE1BQU0sSUFBRDtXQUFwQjtpQkFFekIsV0FBYSxjQUFnQixZQUFhLE1BQTdCO1NBTFQ7T0FNVjtlQUNFLElBQUksMkJBQUEsQ0FBQSxDQUFBLENBQTRCLEdBQWhDOzs7R0FoQk47O0FBa0JKLElBQUssQ0FBQSxDQUFBLENBQUUsUUFBUSxVQUFELEVBQWEsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUQsQ0FBbkI7QUFFMUIsVUFBWSxDQUFBLENBQUEsQ0FBRSxJQUFJLENBQUMsQ0FBRSxDQUFBLEVBQUEsQ0FBRztBQUN4QixNQUFPLENBQUEsQ0FBQSxDQUFFLElBQUksQ0FBQyxDQUFFLENBQUEsRUFBQSxDQUFHO0FBQ25CLGVBQWtCLElBQUksQ0FBQyxHQUFHLFlBQWEsTUFBckIiLCJzb3VyY2VzQ29udGVudCI6WyJgYCMhL3Vzci9iaW4vZW52IG5vZGVgYFxuXG57IHJlamVjdCwgZWFjaCwga2V5cywgbWFwLCBlbGVtLWluZGV4LCBmaW5kLWluZGV4LCBqb2luLCBpcy10eXBlLCBjb21wYWN0LCBjb25jYXQgfSA9IHJlcXVpcmUgJ3ByZWx1ZGUtbHMnXG57IHJhbmdlIH0gPSByZXF1aXJlICdsb2Rhc2gnXG57IG5hbWUsIHZlcnNpb24gfSA9IHJlcXVpcmUgJy4uL3BhY2thZ2UnXG5mcyA9IHJlcXVpcmUgJ2ZzJ1xuZG93bmxvYWQgPSByZXF1aXJlICdkb3dubG9hZCdcbm1rZGlycCA9IHJlcXVpcmUgJ21rZGlycCdcbnhsc3gtdG8tanNvbiA9IHJlcXVpcmUgJ25vZGUtZXhjZWwtdG8tanNvbidcbkV4Y2VsID0gcmVxdWlyZSAnZXhjZWxqcydcblxubXNnID0gKG0pIC0+IGNvbnNvbGUubG9nIFwiI3tuYW1lfSAoI3t2ZXJzaW9ufSk6ICN7bX1cIlxuZXhjZWwtc2FtcGxlLWZpbGUgPSAnLi90ZXN0L2RhdGEtc291cmNlL2kxOG4tZ2VuLXNhbXBsZS1zb3VyY2UueGxzeCdcbiMgeGxzeC10by1qc29uIGRvXG4jICAgZXhjZWwtc2FtcGxlLWZpbGVcbiMgICAoZXJyLCBvdXRwdXQpIC0+XG4jICAgICBpZiBlcnJcbiMgICAgICAgY29uc29sZS5sb2cgZXJyXG4jICAgICBlbHNlXG4jICAgICAgIGNvbnNvbGUubG9nIG91dHB1dFxud2IgPSBuZXcgRXhjZWwuV29ya2Jvb2shXG53Yi54bHN4LnJlYWQtZmlsZSBleGNlbC1zYW1wbGUtZmlsZVxuICAudGhlbiAtPlxuICAgIHdzID0gd2IuZ2V0LXdvcmtzaGVldCgxKVxuICAgIHJlc3VsdCA9IHJhbmdlKDEsIHdzLmFjdHVhbFJvd0NvdW50ICsgMSlcbiAgICAgIC5tYXAoKGkpIC0+IHdzLmdldFJvdyhpKS5fY2VsbHMuc3BsaWNlKDAsIHdzLmFjdHVhbENvbHVtbkNvdW50KS5tYXAoKGMpIC0+IGMudmFsdWUpKVxuXG4gICAgY29uc29sZS5sb2cgcmVzdWx0XG5cbmNvbXBvc2UteWFtbC1saW5lID0gKGxpbmUtaXRlbXMsIHZhbC1jb2wpIC0+XG4gICMgZmluZCAxc3Qgbm9uLWVtcHR5IGNvbHVtbiBvZiB0aGUgbGluZS5cbiAgIyB3aGljaCBpcyB0aGUga2V5LWluZGV4IG9mIHRoZSBjb3JyZXNwb25kaW5nIHlhbWwgbGluZVxuICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgdW5sZXNzIGlzLXR5cGUgJ1VuZGVmaW5lZCcsIGtleS1pbmRleFxuICAgIGluZGVudC1uLWtleSA9IFwiI3snICAnICoga2V5LWluZGV4fSN7bGluZS1pdGVtc1trZXktaW5kZXhdfVwiXG4gICAgIyB2YWx1ZSA9IGxpbmUtaXRlbXNbbG9jYWxlc1tsYW5nXV0ucmVwbGFjZSgvXFxcIi9naSwnXFxcXFxcXCInKVxuICAgIHZhbHVlID0gbGluZS1pdGVtc1t2YWwtY29sXVxuICAgIGlmIC9eW1xce1xcW10vLnRlc3QodmFsdWUpICMgaGFuZGxlcyB2YWx1ZSBzdGFydGluZyB3aXRoIHNwZWNpYWwgeWFtbCBjaGFyYWN0ZXJcbiAgICAgIHZhbHVlID0gXCInI3t2YWx1ZX0nXCIgIyBhZGQgc2luZ2xlIHF1b3RlXG4gICAgbGluZSA9IFwiI3tpbmRlbnQtbi1rZXl9OlwiICsgKGlmIHZhbHVlIHRoZW4gXCIgI3t2YWx1ZX1cIiBlbHNlICcnKVxuXG5kYXRhLXRvLWkxOG4gPSAocmF3LXJvd3MsIGRlc3QtZm9sZGVyLCBmb3JtYXQpIC0+XG4gIFsgaGVhZGVyLCAuLi5yb3dzIF0gPSByYXctcm93c1xuICBsb2NhbGVzID0ge30gIyBlLmcuIHsnZW4nOjMsICd6aCc6NH1cbiAgIyBoZWFkZXItaXRlbXMgPSBoZWFkZXIuc3BsaXQgJ1xcdCdcbiAgaGVhZGVyLWl0ZW1zID0gaGVhZGVyXG4gIGhlYWRlci1pdGVtcyB8PiBlYWNoIC0+XG4gICAgaWYgKGl0IG5vdCBpbiBbICcnICcjJyAncmVtYXJrJ10pXG4gICAgICBsb2NhbGVzW2l0XSA9IGVsZW0taW5kZXggaXQsIGhlYWRlci1pdGVtc1xuXG4gIHN3aXRjaFxuICBjYXNlIGZvcm1hdCBpbiBbJ3lhbWwnLCAneW1sJ11cbiAgICBtc2cgXCJHZW5lcmF0aW5nICN7Zm9ybWF0fSBmaWxlcyAuLi5cIlxuICAgIGxvY2FsZXMgfD4ga2V5cyB8PiBlYWNoIChsYW5nKSAtPlxuICAgICAgeWFtbC1yb3dzID0gcm93c1xuICAgICAgICAgICAgICAgIHw+IG1hcCAobGluZSkgLT5cbiAgICAgICAgICAgICAgICAgICAgIyBjb21wb3NlLXlhbWwtbGluZSAobGluZS5zcGxpdCAnXFx0JyksIGxvY2FsZXNbbGFuZ11cbiAgICAgICAgICAgICAgICAgICAgY29tcG9zZS15YW1sLWxpbmUgbGluZSwgbG9jYWxlc1tsYW5nXVxuICAgICAgICAgICAgICAgIHw+IGpvaW4gJ1xcbidcbiAgICAgIG91dC1maWxlLXBhdGggPSBcIiN7ZGVzdC1mb2xkZXJ9LyN7bGFuZ30uaTE4bi55bWxcIlxuICAgICAgbXNnIFwiXFx0IC0+ICN7b3V0LWZpbGUtcGF0aH1cIlxuICAgICAgZnMgLndyaXRlLWZpbGUtc3luYyBvdXQtZmlsZS1wYXRoLCB5YW1sLXJvd3MsIHsgZmxhZzogJ3cnfVxuXG4gIGNhc2UgZm9ybWF0IGluIFsnanNvbiddXG4gICAgbXNnIFwiR2VuZXJhdGluZyAje2Zvcm1hdH0gZmlsZXMgLi4uXCJcbiAgICBwcmVmaXgta2V5cyA9IFtdXG4gICAgbG9jYWxlcyB8PiBrZXlzIHw+IGVhY2ggKGxhbmcpIC0+XG4gICAgICBqc29uLXJvd3MgPSByb3dzXG4gICAgICAgICAgICAgICAgfD4gbWFwIChsaW5lKSAtPlxuICAgICAgICAgICAgICAgICAgICBqc29uLWxpbmUgPSAnJ1xuICAgICAgICAgICAgICAgICAgICAjIGxpbmUtaXRlbXMgPSBsaW5lLnNwbGl0ICdcXHQnXG4gICAgICAgICAgICAgICAgICAgIGxpbmUtaXRlbXMgPSBsaW5lXG4gICAgICAgICAgICAgICAgICAgICMgZmluZCAxc3Qgbm9uLWVtcHR5IGNvbHVtbiBvZiB0aGUgbGluZS5cbiAgICAgICAgICAgICAgICAgICAgIyB3aGljaCBpcyB0aGUga2V5LWluZGV4IG9mIHRoZSBjb3JyZXNwb25kaW5nIHlhbWwgbGluZVxuICAgICAgICAgICAgICAgICAgICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgICAgICAgICAgICAgICAgICAgY29tcGFjdGVkLWl0ZW1zID0gY29tcGFjdChsaW5lLWl0ZW1zKVxuICAgICAgICAgICAgICAgICAgICBpZiBrZXktaW5kZXggPT0gMCAjIHRvcCBsZXZlbCBrZXlcbiAgICAgICAgICAgICAgICAgICAgICBwcmVmaXgta2V5cyA6PSBbXSAjIHJlc2V0IHByZWZpeC1rZXlzIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIGlmIGNvbXBhY3RlZC1pdGVtcy5sZW5ndGggPT0gMSAjIGxpbmUgd2l0aCBvbmx5IG9uZSBwcmVmaXgta2V5XG4gICAgICAgICAgICAgICAgICAgICAgcHJlZml4LWtleXNba2V5LWluZGV4XSA9IGNvbXBhY3RlZC1pdGVtc1swXSAjIHJlcGxhY2UgcHJlZml4LWtleXNcbiAgICAgICAgICAgICAgICAgICAgaWYgY29tcGFjdGVkLWl0ZW1zLmxlbmd0aCA+IDEgIyBsaW5lIGNvbnRhaW5pbmcgbGVhdmUgbGV2ZWwga2V5IGFuZCBsYW5nIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy1rZXkgPSBjb21wYWN0ZWQtaXRlbXNbMF1cbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLXZhbHVlID0gbGluZS1pdGVtc1tsb2NhbGVzW2xhbmddXS5yZXBsYWNlKC9cXFwiL2dpLCdcXFxcXFxcIicpICMgZXNjYXBlIGRvdWJsZSBxdW90ZSAnXCInXG4gICAgICAgICAgICAgICAgICAgICAganNvbi1saW5lIDo9IFwiICBcXFwiI3soIGNvbmNhdCBbIHByZWZpeC1rZXlzLCBbIHRoaXMta2V5IF0gXSB8PiBqb2luICcuJyApfVxcXCIgOiBcXFwiI3t0aGlzLXZhbHVlfVxcXCJcIlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ganNvbi1saW5lXG4gICAgICAgICAgICAgICAgfD4gcmVqZWN0IC0+IGl0ID09ICcnICMgcmVtb3ZlIGVtcHR5IHJvd3NcbiAgICAgICAgICAgICAgICB8PiBqb2luICcsXFxuJ1xuICAgICAganNvbi1jb250ZW50ID0gXCJ7XFxuI3tqc29uLXJvd3N9XFxufVwiXG4gICAgICBvdXQtZmlsZS1wYXRoID0gXCIje2Rlc3QtZm9sZGVyfS8je2xhbmd9Lmpzb25cIlxuICAgICAgbXNnIFwiXFx0IC0+ICN7b3V0LWZpbGUtcGF0aH1cIlxuICAgICAgZnMgLndyaXRlLWZpbGUtc3luYyBvdXQtZmlsZS1wYXRoLCBqc29uLWNvbnRlbnQsIHsgZmxhZzogJ3cnfVxuXG4gIGRlZmF1bHRcbiAgICBtc2cgXCJVbnN1cHBvcnRlZCBmb3JtYXQhXCJcblxuZ2VuLWkxOG4tZnJvbS1zcmMgPSAoc3JjLCBkZXN0LWZvbGRlciwgZm9ybWF0KSAtPlxuICBzcmMgPSBzcmMgfHwgJydcbiAgZGVzdC1mb2xkZXIgPSBkZXN0LWZvbGRlciB8fCAnLidcbiAgaWYgbm90IHNyYy50cmltIVxuICAgIG1zZyBcIk5vIGRhdGEgc291cmNlIHNwZWNpZmllZFwiXG4gICAgcmV0dXJuXG4gICMgbWFrZSBzdXJlIGRlc3QtZm9sZGVyIGV4aXN0c1xuICBta2RpcnAgZG9cbiAgICBkZXN0LWZvbGRlci50cmltIVxuICAgIChlcnIpIC0+XG4gICAgICBpZiAoZXJyKVxuICAgICAgICBtc2cgXCJFcnJvciBjcmVhdGluZyBkZXN0aW5hdGlvbiBmb2xkZXI6ICN7ZGVzdC1mb2xkZXJ9XCJcbiAgICAgIGVsc2VcbiAgICAgICAgbXNnIFwiQ3JlYXRlZCBkZXN0aW5hdGlvbiBmb2xkZXI6ICN7ZGVzdC1mb2xkZXJ9XCJcbiAgICAgICAgaWYgL15odHRwLy50ZXN0IHNyYy50by1sb3dlci1jYXNlIVxuICAgICAgICAgIG1zZyBcIlVzaW5nIHJlbW90ZSBpMThuIHNvdXJjZTogI3tzcmN9XCJcbiAgICAgICAgICBkb3dubG9hZCBzcmNcbiAgICAgICAgICAgIC50aGVuIChkYXRhKSAtPlxuICAgICAgICAgICAgICAjIGFzc3VtaW5nIGRhdGEgaXMgdmFsaWQgLnRzdiBmb3JtYXRcbiAgICAgICAgICAgICAgcmF3LWRhdGEtdGFibGUgPSBkYXRhLnRvLXN0cmluZyFzcGxpdCgnXFxyXFxuJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwIChsaW5lKSAtPiBsaW5lLnNwbGl0KCdcXHQnKVxuICAgICAgICAgICAgICAjIGRhdGEtdG8taTE4biBkYXRhLnRvU3RyaW5nIXNwbGl0KCdcXHJcXG4nKSwgZGVzdC1mb2xkZXIsIGZvcm1hdFxuICAgICAgICAgICAgICBkYXRhLXRvLWkxOG4gcmF3LWRhdGEtdGFibGUsIGRlc3QtZm9sZGVyLCBmb3JtYXRcbiAgICAgICAgZWxzZVxuICAgICAgICAgIG1zZyBcIlVzaW5nIGxvY2FsIGkxOG4gc291cmNlOiAje3NyY31cIlxuXG5hcmd2ID0gcmVxdWlyZSgnbWluaW1pc3QnKShwcm9jZXNzLmFyZ3Yuc2xpY2UoMikpXG4jIG1zZyBKU09OLnN0cmluZ2lmeSBhcmd2XG5kZXN0LWZvbGRlciA9IGFyZ3YucCB8fCAnLidcbmZvcm1hdCA9IGFyZ3YuZiB8fCAneW1sJyAjICd5bWwnIChkZWZhdWx0KSBvciAnanNvbidcbmdlbi1pMThuLWZyb20tc3JjIGFyZ3YucywgZGVzdC1mb2xkZXIsIGZvcm1hdFxuIl19
