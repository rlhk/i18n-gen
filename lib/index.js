#!/usr/bin/env node
var ref$, reject, each, keys, map, elemIndex, findIndex, join, isType, compact, concat, range, name, version, fs, download, mkdirp, xlsxToJson, Excel, msg, readSpreadsheet, composeYamlLine, dataToI18n, genI18nFromSrc, argv, destFolder, format, slice$ = [].slice;
ref$ = require('prelude-ls'), reject = ref$.reject, each = ref$.each, keys = ref$.keys, map = ref$.map, elemIndex = ref$.elemIndex, findIndex = ref$.findIndex, join = ref$.join, isType = ref$.isType, compact = ref$.compact, concat = ref$.concat;
range = require('lodash').range;
ref$ = require('../package'), name = ref$.name, version = ref$.version;
fs = require('fs');
download = require('download');
mkdirp = require('mkdirp');
xlsxToJson = require('node-excel-to-json');
Excel = require('exceljs');
msg = function(m){
  return console.log(name + " (" + version + "): " + m);
};
readSpreadsheet = function(filePath){
  var wb;
  wb = new Excel.Workbook();
  return wb.xlsx.readFile(filePath).then(function(){
    var ws, rowCount, colCount, result;
    ws = wb.getWorksheet(1);
    rowCount = ws.actualRowCount;
    colCount = ws.actualColumnCount;
    return result = range(1, rowCount + 1).map(function(i){
      return ws.getRow(i)._cells.splice(0, colCount).map(function(c){
        return c.value;
      });
    });
  })['catch'](function(reason){
    return reason;
  });
};
composeYamlLine = function(lineItems, valCol){
  var keyIndex, indentNKey, value, line;
  keyIndex = findIndex(function(it){
    return it !== null && it !== undefined && it !== '';
  })(
  lineItems);
  if (!isType('Undefined', keyIndex)) {
    indentNKey = repeatString$('  ', keyIndex) + "" + lineItems[keyIndex];
    value = lineItems[valCol];
    if (/^[\{\[]/.test(value)) {
      value = "'" + value + "'";
    }
    return line = (indentNKey + ":") + (value ? " " + value : '');
  }
};
dataToI18n = function(dataRows, destFolder, format){
  var header, rows, locales, headerItems, prefixKeys;
  header = dataRows[0], rows = slice$.call(dataRows, 1);
  locales = {};
  headerItems = header;
  each(function(it){
    if (it !== null && it !== undefined && it !== '' && it !== '#' && it !== 'remark') {
      return locales[it] = elemIndex(it, headerItems);
    }
  })(
  headerItems);
  switch (false) {
  case format !== 'yaml' && format !== 'yml':
    msg("Generating " + format + " files ...");
    return each(function(lang){
      var yamlRows, outFilePath;
      yamlRows = join('\n')(
      map(function(line){
        return composeYamlLine(line, locales[lang]);
      })(
      rows));
      outFilePath = destFolder + "/" + lang + ".i18n.yml";
      msg("\t -> " + outFilePath);
      return fs.writeFileSync(outFilePath, yamlRows, {
        flag: 'w'
      });
    })(
    keys(
    locales));
  case !in$(format, ['json']):
    msg("Generating " + format + " files ...");
    prefixKeys = [];
    return each(function(lang){
      var jsonRows, jsonContent, outFilePath;
      jsonRows = join(',\n')(
      reject(function(it){
        return it === '';
      })(
      map(function(line){
        var jsonLine, lineItems, keyIndex, compactedItems, thisKey, thisValue;
        jsonLine = '';
        lineItems = line;
        keyIndex = findIndex(function(it){
          return it !== null && it !== undefined && it !== '';
        })(
        lineItems);
        compactedItems = compact(lineItems);
        if (keyIndex === 0) {
          prefixKeys = [];
        }
        if (compactedItems.length === 1) {
          prefixKeys[keyIndex] = compactedItems[0];
        }
        if (compactedItems.length > 1) {
          thisKey = compactedItems[0];
          thisValue = lineItems[locales[lang]].replace(/\"/gi, '\\"');
          jsonLine = "  \"" + join('.')(
          concat([prefixKeys, [thisKey]])) + "\" : \"" + thisValue + "\"";
        }
        return jsonLine;
      })(
      rows)));
      jsonContent = "{\n" + jsonRows + "\n}";
      outFilePath = destFolder + "/" + lang + ".json";
      msg("\t -> " + outFilePath);
      return fs.writeFileSync(outFilePath, jsonContent, {
        flag: 'w'
      });
    })(
    keys(
    locales));
  default:
    return msg("Unsupported format!");
  }
};
genI18nFromSrc = function(src, destFolder, format){
  src = src || '';
  destFolder = destFolder || '.';
  if (!src.trim()) {
    msg("No data source specified");
    return;
  }
  return mkdirp(destFolder.trim(), function(err){
    if (err) {
      return msg("Error creating destination folder: " + destFolder);
    } else {
      msg("Created destination folder: " + destFolder);
      if (/^http/.test(src.toLowerCase())) {
        msg("Using remote i18n source (assuming valid .TSV): " + src);
        return download(src).then(function(rawData){
          var dataTable;
          dataTable = rawData.toString().split('\r\n').map(function(line){
            return line.split('\t');
          });
          return dataToI18n(dataTable, destFolder, format);
        });
      } else {
        msg("Using local i18n source (assuming valid .XLSX): " + src);
        return readSpreadsheet(src).then(function(result){
          return dataToI18n(result, destFolder, format);
        })['catch'](function(reason){
          return console.log(reason);
        });
      }
    }
  });
};
argv = require('minimist')(process.argv.slice(2));
msg(JSON.stringify(argv));
destFolder = argv.p || '.';
format = argv.f || 'yml';
genI18nFromSrc(argv.s, destFolder, format);
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9pbmRleC5scyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLElBQUEsR0FBc0YsT0FBdEYsQ0FBOEYsWUFBQSxDQUE5RixFQUFFLE1BQWtGLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQUUsTUFBRixFQUFVLElBQTBFLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQVUsSUFBVixFQUFnQixJQUFvRSxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFnQixJQUFoQixFQUFzQixHQUE4RCxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFzQixHQUF0QixFQUEyQixTQUF5RCxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUEyQixTQUEzQixFQUF1QyxTQUE2QyxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUF1QyxTQUF2QyxFQUFtRCxJQUFpQyxDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFtRCxJQUFuRCxFQUF5RCxNQUEyQixDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUF5RCxNQUF6RCxFQUFrRSxPQUFrQixDQUFBLENBQUEsQ0FBcEYsSUFBQSxDQUFrRSxPQUFsRSxFQUEyRSxNQUFTLENBQUEsQ0FBQSxDQUFwRixJQUFBLENBQTJFO0FBQ3pFLEtBQVEsQ0FBQSxDQUFBLENBQUUsT0FBWixDQUFvQixRQUFBLENBQXBCLENBQUU7QUFDRixJQUFBLEdBQW9CLE9BQXBCLENBQTRCLFlBQUEsQ0FBNUIsRUFBRSxJQUFnQixDQUFBLENBQUEsQ0FBbEIsSUFBQSxDQUFFLElBQUYsRUFBUSxPQUFVLENBQUEsQ0FBQSxDQUFsQixJQUFBLENBQVE7QUFDUixFQUFHLENBQUEsQ0FBQSxDQUFFLFFBQVEsSUFBQTtBQUNiLFFBQVMsQ0FBQSxDQUFBLENBQUUsUUFBUSxVQUFBO0FBQ25CLE1BQU8sQ0FBQSxDQUFBLENBQUUsUUFBUSxRQUFBO0FBQ2pCLFVBQWEsQ0FBQSxDQUFBLENBQUUsUUFBUSxvQkFBQTtBQUN2QixLQUFNLENBQUEsQ0FBQSxDQUFFLFFBQVEsU0FBQTtBQUVoQixHQUFJLENBQUEsQ0FBQSxDQUFFLFFBQUEsQ0FBQSxDQUFBO1NBQU8sT0FBTyxDQUFDLElBQU8sSUFBSSxDQUFBLENBQUEsQ0FBQyxJQUFBLENBQUEsQ0FBQSxDQUFJLE9BQU8sQ0FBQSxDQUFBLENBQUMsS0FBQSxDQUFBLENBQUEsQ0FBSyxDQUE3Qjs7QUFHckIsZUFBaUIsQ0FBQSxDQUFBLENBQUUsUUFBQSxDQUFBLFFBQUE7O0VBQ2pCLEVBQUcsQ0FBQSxDQUFBLEtBQU0sS0FBSyxDQUFDLFNBQVE7U0FDdkIsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFVLFFBQUEsQ0FDaEIsQ0FBQyxLQUFLLFFBQUEsQ0FBQTs7SUFDSixFQUFHLENBQUEsQ0FBQSxDQUFFLEVBQUUsQ0FBQyxhQUFjLENBQUQ7SUFDckIsUUFBVSxDQUFBLENBQUEsQ0FBRSxFQUFFLENBQUM7SUFDZixRQUFVLENBQUEsQ0FBQSxDQUFFLEVBQUUsQ0FBQztXQUVmLE1BQU8sQ0FBQSxDQUFBLENBQUUsTUFBTSxHQUFHLFFBQVUsQ0FBQSxDQUFBLENBQUUsQ0FBaEIsQ0FDWixDQUFDLElBQUksUUFBQSxDQUFBLENBQUE7YUFBTyxFQUFFLENBQUMsT0FBUSxDQUFELENBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLFFBQUosQ0FBYyxDQUFDLElBQUksUUFBQSxDQUFBLENBQUE7ZUFBTyxDQUFDLENBQUM7T0FBVjtLQUFyRDtHQU5GLENBUU4sQ0FBQyxPQUFELEVBQU8sUUFBQSxDQUFBLE1BQUE7V0FBWTtHQUFaOztBQUVYLGVBQWtCLENBQUEsQ0FBQSxDQUFFLFFBQUEsQ0FBQSxTQUFBLEVBQUEsTUFBQTs7RUFJbEIsUUFBVSxDQUFBLENBQUEsQ0FBZ0IsVUFBVyxRQUFBLENBQUEsRUFBQTtXQUFHLEVBQUEsS0FBWSxJQUFaLElBQUEsRUFBQSxLQUFrQixTQUFsQixJQUFBLEVBQUEsS0FBNkI7R0FBaEM7RUFBekI7RUFDWixJQUFBLENBQU8sTUFBUCxDQUFlLFdBQWYsRUFBNEIsUUFBYixDQUFmO0lBQ0UsVUFBYSxDQUFBLENBQUEsQ0FBVSxhQUFBLENBQUwsSUFBSyxFQUFFLFFBQUYsQ0FBVyxDQUFBLENBQUEsQ0FBQyxFQUFBLENBQUEsQ0FBQSxDQUFFLFNBQVUsQ0FBQyxRQUFEO0lBRS9DLEtBQU0sQ0FBQSxDQUFBLENBQUUsU0FBVSxDQUFDLE1BQUQ7SUFDbEIsSUFBRyxTQUFTLENBQUMsSUFBYixDQUFrQixLQUFELENBQWpCO01BQ0UsS0FBTSxDQUFBLENBQUEsQ0FBRSxHQUFBLENBQUEsQ0FBQSxDQUFJLEtBQUssQ0FBQSxDQUFBLENBQUM7O1dBQ3BCLElBQUssQ0FBQSxDQUFBLENBQUEsQ0FBSyxVQUFZLENBQUEsQ0FBQSxDQUFDLEdBQUUsQ0FBQyxDQUFBLENBQUEsQ0FBQSxDQUFNLEtBQU4sQ0FBWSxFQUFLLEdBQUEsQ0FBQSxDQUFBLENBQUksS0FBckIsQ0FBNkIsRUFBSyxFQUFsQzs7O0FBRTlCLFVBQWEsQ0FBQSxDQUFBLENBQUUsUUFBQSxDQUFBLFFBQUEsRUFBQSxVQUFBLEVBQUEsTUFBQTs7RUFFWCxNQUFrQixDQUFBLENBQUEsQ0FBcEIsUUFBQSxDQUFBLENBQUEsQ0FBQSxFQUFhLElBQU8sQ0FBQSxDQUFBLENBQXBCO0VBQ0EsT0FBUSxDQUFBLENBQUEsQ0FBRTtFQUVWLFdBQWEsQ0FBQSxDQUFBLENBQUU7RUFDQyxLQUFLLFFBQUEsQ0FBQSxFQUFBO0lBQ25CLElBQUksRUFBQSxLQUFZLElBQVosSUFBQSxFQUFBLEtBQWtCLFNBQWxCLElBQUEsRUFBQSxLQUE2QixFQUE3QixJQUFBLEVBQUEsS0FBZ0MsR0FBaEMsSUFBQSxFQUFBLEtBQW9DLFFBQXhDO2FBQ0UsT0FBTyxDQUFDLEVBQUQsQ0FBSyxDQUFBLENBQUEsQ0FBRSxVQUFXLElBQUksV0FBSjs7R0FGUjtFQUFyQjtFQUlBLFFBQUEsS0FBQTtBQUFBLEVBQ0ssS0FBQSxNQUFBLEtBQVcsTUFBWCxJQUFBLE1BQUEsS0FBbUIsS0FBbkI7QUFBQSxJQUNILElBQUksYUFBQSxDQUFBLENBQUEsQ0FBYyxNQUFNLENBQUEsQ0FBQSxDQUFDLFlBQXpCO1dBQ21CLEtBQUssUUFBQSxDQUFBLElBQUE7O01BQ3RCLFFBQVUsQ0FBQSxDQUFBLENBR0csS0FBSyxJQUFBO01BRkwsSUFBSSxRQUFBLENBQUEsSUFBQTtlQUNILGdCQUFrQixNQUFNLE9BQU8sQ0FBQyxJQUFELENBQWI7T0FEZjtNQURMO01BSVosV0FBYyxDQUFBLENBQUEsQ0FBSyxVQUFXLENBQUEsQ0FBQSxDQUFDLEdBQUEsQ0FBQSxDQUFBLENBQUcsSUFBSSxDQUFBLENBQUEsQ0FBQztNQUN2QyxJQUFJLFFBQUEsQ0FBQSxDQUFBLENBQVMsV0FBYjthQUNBLEVBQUcsQ0FBQyxjQUFnQixhQUFlLFVBQVc7UUFBRSxNQUFNO01BQVIsQ0FBMUI7S0FQRTtJQUFiO0lBQVg7RUFTRyxLQUFBLENBQUEsR0FBQSxDQUFBLE1BQUEsRUFBVSxDQUFDLE1BQUQsQ0FBVixDQUFBO0FBQUEsSUFDSCxJQUFJLGFBQUEsQ0FBQSxDQUFBLENBQWMsTUFBTSxDQUFBLENBQUEsQ0FBQyxZQUF6QjtJQUNBLFVBQVksQ0FBQSxDQUFBLENBQUU7V0FDSyxLQUFLLFFBQUEsQ0FBQSxJQUFBOztNQUN0QixRQUFVLENBQUEsQ0FBQSxDQWtCRyxLQUFLLEtBQUE7TUFETCxPQUFPLFFBQUEsQ0FBQSxFQUFBO2VBQUcsRUFBRyxDQUFBLEdBQUEsQ0FBRztPQUFUO01BaEJQLElBQUksUUFBQSxDQUFBLElBQUE7O1FBQ0gsUUFBVSxDQUFBLENBQUEsQ0FBRTtRQUNaLFNBQVcsQ0FBQSxDQUFBLENBQUU7UUFHYixRQUFVLENBQUEsQ0FBQSxDQUFnQixVQUFXLFFBQUEsQ0FBQSxFQUFBO2lCQUFHLEVBQUEsS0FBWSxJQUFaLElBQUEsRUFBQSxLQUFrQixTQUFsQixJQUFBLEVBQUEsS0FBNkI7U0FBaEM7UUFBekI7UUFDWixjQUFnQixDQUFBLENBQUEsQ0FBRSxRQUFRLFNBQUQ7UUFDekIsSUFBRyxRQUFVLENBQUEsR0FBQSxDQUFHLENBQWhCO1VBQ0UsVUFBWSxDQUFBLENBQUEsQ0FBRzs7UUFDakIsSUFBRyxjQUFlLENBQUMsTUFBTyxDQUFBLEdBQUEsQ0FBRyxDQUE3QjtVQUNFLFVBQVcsQ0FBQyxRQUFELENBQVksQ0FBQSxDQUFBLENBQUUsY0FBZSxDQUFDLENBQUQ7O1FBQzFDLElBQUcsY0FBZSxDQUFDLE1BQU8sQ0FBQSxDQUFBLENBQUUsQ0FBNUI7VUFDRSxPQUFTLENBQUEsQ0FBQSxDQUFFLGNBQWUsQ0FBQyxDQUFEO1VBQzFCLFNBQVcsQ0FBQSxDQUFBLENBQUUsU0FBVSxDQUFDLE9BQU8sQ0FBQyxJQUFELENBQVIsQ0FBZSxDQUFDLFFBQVEsUUFBTyxLQUFSO1VBQzlDLFFBQVUsQ0FBQSxDQUFBLENBQUcsTUFBQSxDQUFBLENBQUEsQ0FBaUQsSUFBakQsQ0FBc0QsR0FBQSxDQUF0RDtBQUFBLFVBQVMsTUFBVCxDQUFnQixDQUFFLFVBQWxCLEVBQStCLENBQUUsT0FBRixDQUFmLENBQUEsQ0FBaEIsQ0FBMkQsQ0FBQSxDQUFBLENBQUMsU0FBQSxDQUFBLENBQUEsQ0FBUyxTQUFVLENBQUEsQ0FBQSxDQUFDOztRQUMvRixNQUFBLENBQU8sUUFBUDtPQWZHO01BREw7TUFtQlosV0FBYSxDQUFBLENBQUEsQ0FBRSxLQUFBLENBQUEsQ0FBQSxDQUFNLFFBQVMsQ0FBQSxDQUFBLENBQUM7TUFDL0IsV0FBYyxDQUFBLENBQUEsQ0FBSyxVQUFXLENBQUEsQ0FBQSxDQUFDLEdBQUEsQ0FBQSxDQUFBLENBQUcsSUFBSSxDQUFBLENBQUEsQ0FBQztNQUN2QyxJQUFJLFFBQUEsQ0FBQSxDQUFBLENBQVMsV0FBYjthQUNBLEVBQUcsQ0FBQyxjQUFnQixhQUFlLGFBQWM7UUFBRSxNQUFNO01BQVIsQ0FBN0I7S0F2QkU7SUFBYjtJQUFYOztXQTBCQSxJQUF5QixxQkFBQTs7O0FBRTdCLGNBQWtCLENBQUEsQ0FBQSxDQUFFLFFBQUEsQ0FBQSxHQUFBLEVBQUEsVUFBQSxFQUFBLE1BQUE7RUFDbEIsR0FBSSxDQUFBLENBQUEsQ0FBRSxHQUFJLENBQUEsRUFBQSxDQUFHO0VBQ2IsVUFBWSxDQUFBLENBQUEsQ0FBRSxVQUFZLENBQUEsRUFBQSxDQUFHO0VBQzdCLElBQUcsQ0FBSSxHQUFHLENBQUMsSUFBUixDQUFZLENBQWY7SUFDRSxJQUE4QiwwQkFBQTtJQUM5QixNQUFBOztTQUNGLE9BQ0UsVUFBVyxDQUFDLEtBQUksR0FDaEIsUUFBQSxDQUFBLEdBQUE7SUFDRSxJQUFJLEdBQUo7YUFDRSxJQUFJLHFDQUFBLENBQUEsQ0FBQSxDQUFzQyxVQUExQztLQUNGO01BQ0UsSUFBSSw4QkFBQSxDQUFBLENBQUEsQ0FBK0IsVUFBbkM7TUFDQSxJQUFHLE9BQU8sQ0FBQyxJQUFYLENBQWdCLEdBQUcsQ0FBQyxXQUFwQixDQUFpQyxDQUFqQixDQUFoQjtRQUNFLElBQUksa0RBQUEsQ0FBQSxDQUFBLENBQW1ELEdBQXZEO2VBQ0EsU0FBUyxHQUFBLENBQ1AsQ0FBQyxLQUFLLFFBQUEsQ0FBQSxPQUFBOztVQUdKLFNBQVcsQ0FBQSxDQUFBLENBQUUsT0FBUSxDQUFDLFNBQVMsQ0FBQyxDQUFBLE1BQU0sTUFBRCxDQUNqQixDQUFDLElBQUksUUFBQSxDQUFBLElBQUE7bUJBQVUsSUFBSSxDQUFDLE1BQU0sSUFBRDtXQUFwQjtpQkFDekIsV0FBYSxXQUFZLFlBQWEsTUFBekI7U0FMVDtPQU1WO1FBQ0UsSUFBSSxrREFBQSxDQUFBLENBQUEsQ0FBbUQsR0FBdkQ7ZUFDQSxnQkFBaUIsR0FBQSxDQUNmLENBQUMsS0FBSyxRQUFBLENBQUEsTUFBQTtpQkFBWSxXQUFhLFFBQVEsWUFBYSxNQUFyQjtTQUF6QixDQUNOLENBQUMsT0FBRCxFQUFPLFFBQUEsQ0FBQSxNQUFBO2lCQUFZLE9BQU8sQ0FBQyxJQUFJLE1BQUE7U0FBeEI7OztHQW5CZjs7QUFxQkosSUFBSyxDQUFBLENBQUEsQ0FBRSxRQUFRLFVBQUQsRUFBYSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBRCxDQUFuQjtBQUMxQixJQUFJLElBQUksQ0FBQyxVQUFVLElBQUEsQ0FBZjtBQUNKLFVBQVksQ0FBQSxDQUFBLENBQUUsSUFBSSxDQUFDLENBQUUsQ0FBQSxFQUFBLENBQUc7QUFDeEIsTUFBTyxDQUFBLENBQUEsQ0FBRSxJQUFJLENBQUMsQ0FBRSxDQUFBLEVBQUEsQ0FBRztBQUNuQixlQUFrQixJQUFJLENBQUMsR0FBRyxZQUFhLE1BQXJCIiwic291cmNlc0NvbnRlbnQiOlsiYGAjIS91c3IvYmluL2VudiBub2RlYGBcblxueyByZWplY3QsIGVhY2gsIGtleXMsIG1hcCwgZWxlbS1pbmRleCwgZmluZC1pbmRleCwgam9pbiwgaXMtdHlwZSwgY29tcGFjdCwgY29uY2F0IH0gPSByZXF1aXJlICdwcmVsdWRlLWxzJ1xueyByYW5nZSB9ID0gcmVxdWlyZSAnbG9kYXNoJ1xueyBuYW1lLCB2ZXJzaW9uIH0gPSByZXF1aXJlICcuLi9wYWNrYWdlJ1xuZnMgPSByZXF1aXJlICdmcydcbmRvd25sb2FkID0gcmVxdWlyZSAnZG93bmxvYWQnXG5ta2RpcnAgPSByZXF1aXJlICdta2RpcnAnXG54bHN4LXRvLWpzb24gPSByZXF1aXJlICdub2RlLWV4Y2VsLXRvLWpzb24nXG5FeGNlbCA9IHJlcXVpcmUgJ2V4Y2VsanMnXG5cbm1zZyA9IChtKSAtPiBjb25zb2xlLmxvZyBcIiN7bmFtZX0gKCN7dmVyc2lvbn0pOiAje219XCJcbiMgZXhjZWwtc2FtcGxlLWZpbGUgPSAnLi90ZXN0L2RhdGEtc291cmNlL2kxOG4tZ2VuLXNhbXBsZS1zb3VyY2UueGxzeCdcblxucmVhZC1zcHJlYWRzaGVldCA9IChmaWxlLXBhdGgpIC0+XG4gIHdiID0gbmV3IEV4Y2VsLldvcmtib29rIVxuICB3Yi54bHN4LnJlYWQtZmlsZSBmaWxlLXBhdGhcbiAgICAudGhlbiAtPlxuICAgICAgd3MgPSB3Yi5nZXQtd29ya3NoZWV0KDEpXG4gICAgICByb3ctY291bnQgPSB3cy5hY3R1YWwtcm93LWNvdW50XG4gICAgICBjb2wtY291bnQgPSB3cy5hY3R1YWwtY29sdW1uLWNvdW50XG4gICAgICAjIGNvbnNvbGUubG9nIFwiYWN0dWFsUm93Q291bnQgLyBhY3R1YWxDb2x1bW5Db3VudDogI3tyb3ctY291bnR9IC8gI3tjb2wtY291bnR9XCJcbiAgICAgIHJlc3VsdCA9IHJhbmdlKDEsIHJvdy1jb3VudCArIDEpXG4gICAgICAgIC5tYXAoKGkpIC0+IHdzLmdldC1yb3coaSkuX2NlbGxzLnNwbGljZSgwLCBjb2wtY291bnQpLm1hcCgoYykgLT4gYy52YWx1ZSkpXG4gICAgICAjIGNvbnNvbGUubG9nIHJlc3VsdFxuICAgIC5jYXRjaCAocmVhc29uKSAtPiByZWFzb25cblxuY29tcG9zZS15YW1sLWxpbmUgPSAobGluZS1pdGVtcywgdmFsLWNvbCkgLT5cbiAgIyBjb25zb2xlLmxvZyBcImxpbmUtaXRlbXM6ICN7SlNPTi5zdHJpbmdpZnkobGluZS1pdGVtcyl9XCJcbiAgIyBmaW5kIDFzdCBub24tZW1wdHkgY29sdW1uIG9mIHRoZSBsaW5lLlxuICAjIHdoaWNoIGlzIHRoZSBrZXktaW5kZXggb2YgdGhlIGNvcnJlc3BvbmRpbmcgeWFtbCBsaW5lXG4gIGtleS1pbmRleCA9IGxpbmUtaXRlbXMgfD4gZmluZC1pbmRleCAtPiBpdCBub3QgaW4gWyBudWxsLCB1bmRlZmluZWQsICcnIF1cbiAgdW5sZXNzIGlzLXR5cGUgJ1VuZGVmaW5lZCcsIGtleS1pbmRleFxuICAgIGluZGVudC1uLWtleSA9IFwiI3snICAnICoga2V5LWluZGV4fSN7bGluZS1pdGVtc1trZXktaW5kZXhdfVwiXG4gICAgIyB2YWx1ZSA9IGxpbmUtaXRlbXNbbG9jYWxlc1tsYW5nXV0ucmVwbGFjZSgvXFxcIi9naSwnXFxcXFxcXCInKVxuICAgIHZhbHVlID0gbGluZS1pdGVtc1t2YWwtY29sXVxuICAgIGlmIC9eW1xce1xcW10vLnRlc3QodmFsdWUpICMgaGFuZGxlcyB2YWx1ZSBzdGFydGluZyB3aXRoIHNwZWNpYWwgeWFtbCBjaGFyYWN0ZXJcbiAgICAgIHZhbHVlID0gXCInI3t2YWx1ZX0nXCIgIyBhZGQgc2luZ2xlIHF1b3RlXG4gICAgbGluZSA9IFwiI3tpbmRlbnQtbi1rZXl9OlwiICsgKGlmIHZhbHVlIHRoZW4gXCIgI3t2YWx1ZX1cIiBlbHNlICcnKVxuXG5kYXRhLXRvLWkxOG4gPSAoZGF0YS1yb3dzLCBkZXN0LWZvbGRlciwgZm9ybWF0KSAtPlxuICAjIGNvbnNvbGUubG9nIGRhdGEtcm93c1xuICBbIGhlYWRlciwgLi4ucm93cyBdID0gZGF0YS1yb3dzXG4gIGxvY2FsZXMgPSB7fSAjIGUuZy4geydlbic6MywgJ3poJzo0fVxuICAjIGhlYWRlci1pdGVtcyA9IGhlYWRlci5zcGxpdCAnXFx0J1xuICBoZWFkZXItaXRlbXMgPSBoZWFkZXJcbiAgaGVhZGVyLWl0ZW1zIHw+IGVhY2ggLT5cbiAgICBpZiAoaXQgbm90IGluIFsgbnVsbCwgdW5kZWZpbmVkLCAnJyAnIycgJ3JlbWFyayddKVxuICAgICAgbG9jYWxlc1tpdF0gPSBlbGVtLWluZGV4IGl0LCBoZWFkZXItaXRlbXNcblxuICBzd2l0Y2hcbiAgY2FzZSBmb3JtYXQgaW4gWyd5YW1sJywgJ3ltbCddXG4gICAgbXNnIFwiR2VuZXJhdGluZyAje2Zvcm1hdH0gZmlsZXMgLi4uXCJcbiAgICBsb2NhbGVzIHw+IGtleXMgfD4gZWFjaCAobGFuZykgLT5cbiAgICAgIHlhbWwtcm93cyA9IHJvd3NcbiAgICAgICAgICAgICAgICB8PiBtYXAgKGxpbmUpIC0+XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvc2UteWFtbC1saW5lIGxpbmUsIGxvY2FsZXNbbGFuZ11cbiAgICAgICAgICAgICAgICB8PiBqb2luICdcXG4nXG4gICAgICBvdXQtZmlsZS1wYXRoID0gXCIje2Rlc3QtZm9sZGVyfS8je2xhbmd9LmkxOG4ueW1sXCJcbiAgICAgIG1zZyBcIlxcdCAtPiAje291dC1maWxlLXBhdGh9XCJcbiAgICAgIGZzIC53cml0ZS1maWxlLXN5bmMgb3V0LWZpbGUtcGF0aCwgeWFtbC1yb3dzLCB7IGZsYWc6ICd3J31cblxuICBjYXNlIGZvcm1hdCBpbiBbJ2pzb24nXVxuICAgIG1zZyBcIkdlbmVyYXRpbmcgI3tmb3JtYXR9IGZpbGVzIC4uLlwiXG4gICAgcHJlZml4LWtleXMgPSBbXVxuICAgIGxvY2FsZXMgfD4ga2V5cyB8PiBlYWNoIChsYW5nKSAtPlxuICAgICAganNvbi1yb3dzID0gcm93c1xuICAgICAgICAgICAgICAgIHw+IG1hcCAobGluZSkgLT5cbiAgICAgICAgICAgICAgICAgICAganNvbi1saW5lID0gJydcbiAgICAgICAgICAgICAgICAgICAgbGluZS1pdGVtcyA9IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgIyBmaW5kIDFzdCBub24tZW1wdHkgY29sdW1uIG9mIHRoZSBsaW5lLlxuICAgICAgICAgICAgICAgICAgICAjIHdoaWNoIGlzIHRoZSBrZXktaW5kZXggb2YgdGhlIGNvcnJlc3BvbmRpbmcgeWFtbCBsaW5lXG4gICAgICAgICAgICAgICAgICAgIGtleS1pbmRleCA9IGxpbmUtaXRlbXMgfD4gZmluZC1pbmRleCAtPiBpdCBub3QgaW4gWyBudWxsLCB1bmRlZmluZWQsICcnIF1cbiAgICAgICAgICAgICAgICAgICAgY29tcGFjdGVkLWl0ZW1zID0gY29tcGFjdChsaW5lLWl0ZW1zKVxuICAgICAgICAgICAgICAgICAgICBpZiBrZXktaW5kZXggPT0gMCAjIHRvcCBsZXZlbCBrZXlcbiAgICAgICAgICAgICAgICAgICAgICBwcmVmaXgta2V5cyA6PSBbXSAjIHJlc2V0IHByZWZpeC1rZXlzIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIGlmIGNvbXBhY3RlZC1pdGVtcy5sZW5ndGggPT0gMSAjIGxpbmUgd2l0aCBvbmx5IG9uZSBwcmVmaXgta2V5XG4gICAgICAgICAgICAgICAgICAgICAgcHJlZml4LWtleXNba2V5LWluZGV4XSA9IGNvbXBhY3RlZC1pdGVtc1swXSAjIHJlcGxhY2UgcHJlZml4LWtleXNcbiAgICAgICAgICAgICAgICAgICAgaWYgY29tcGFjdGVkLWl0ZW1zLmxlbmd0aCA+IDEgIyBsaW5lIGNvbnRhaW5pbmcgbGVhdmUgbGV2ZWwga2V5IGFuZCBsYW5nIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy1rZXkgPSBjb21wYWN0ZWQtaXRlbXNbMF1cbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLXZhbHVlID0gbGluZS1pdGVtc1tsb2NhbGVzW2xhbmddXS5yZXBsYWNlKC9cXFwiL2dpLCdcXFxcXFxcIicpICMgZXNjYXBlIGRvdWJsZSBxdW90ZSAnXCInXG4gICAgICAgICAgICAgICAgICAgICAganNvbi1saW5lIDo9IFwiICBcXFwiI3soIGNvbmNhdCBbIHByZWZpeC1rZXlzLCBbIHRoaXMta2V5IF0gXSB8PiBqb2luICcuJyApfVxcXCIgOiBcXFwiI3t0aGlzLXZhbHVlfVxcXCJcIlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ganNvbi1saW5lXG4gICAgICAgICAgICAgICAgfD4gcmVqZWN0IC0+IGl0ID09ICcnICMgcmVtb3ZlIGVtcHR5IHJvd3NcbiAgICAgICAgICAgICAgICB8PiBqb2luICcsXFxuJ1xuICAgICAganNvbi1jb250ZW50ID0gXCJ7XFxuI3tqc29uLXJvd3N9XFxufVwiXG4gICAgICBvdXQtZmlsZS1wYXRoID0gXCIje2Rlc3QtZm9sZGVyfS8je2xhbmd9Lmpzb25cIlxuICAgICAgbXNnIFwiXFx0IC0+ICN7b3V0LWZpbGUtcGF0aH1cIlxuICAgICAgZnMgLndyaXRlLWZpbGUtc3luYyBvdXQtZmlsZS1wYXRoLCBqc29uLWNvbnRlbnQsIHsgZmxhZzogJ3cnfVxuXG4gIGRlZmF1bHRcbiAgICBtc2cgXCJVbnN1cHBvcnRlZCBmb3JtYXQhXCJcblxuZ2VuLWkxOG4tZnJvbS1zcmMgPSAoc3JjLCBkZXN0LWZvbGRlciwgZm9ybWF0KSAtPlxuICBzcmMgPSBzcmMgfHwgJydcbiAgZGVzdC1mb2xkZXIgPSBkZXN0LWZvbGRlciB8fCAnLidcbiAgaWYgbm90IHNyYy50cmltIVxuICAgIG1zZyBcIk5vIGRhdGEgc291cmNlIHNwZWNpZmllZFwiXG4gICAgcmV0dXJuXG4gIG1rZGlycCBkbyAjIGVuc3VyZSBkZXN0LWZvbGRlciBleGlzdGVuY2VcbiAgICBkZXN0LWZvbGRlci50cmltIVxuICAgIChlcnIpIC0+XG4gICAgICBpZiAoZXJyKVxuICAgICAgICBtc2cgXCJFcnJvciBjcmVhdGluZyBkZXN0aW5hdGlvbiBmb2xkZXI6ICN7ZGVzdC1mb2xkZXJ9XCJcbiAgICAgIGVsc2VcbiAgICAgICAgbXNnIFwiQ3JlYXRlZCBkZXN0aW5hdGlvbiBmb2xkZXI6ICN7ZGVzdC1mb2xkZXJ9XCJcbiAgICAgICAgaWYgL15odHRwLy50ZXN0IHNyYy50by1sb3dlci1jYXNlIVxuICAgICAgICAgIG1zZyBcIlVzaW5nIHJlbW90ZSBpMThuIHNvdXJjZSAoYXNzdW1pbmcgdmFsaWQgLlRTVik6ICN7c3JjfVwiXG4gICAgICAgICAgZG93bmxvYWQgc3JjXG4gICAgICAgICAgICAudGhlbiAocmF3LWRhdGEpIC0+XG4gICAgICAgICAgICAgICMgYXNzdW1pbmcgcmF3LWRhdGEgaXMgdmFsaWQgLnRzdiBmb3JtYXRcbiAgICAgICAgICAgICAgIyB0cmFuc2Zvcm0gdG8gYXJyYXkgb2YgYXJyYXlcbiAgICAgICAgICAgICAgZGF0YS10YWJsZSA9IHJhdy1kYXRhLnRvLXN0cmluZyFzcGxpdCgnXFxyXFxuJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwIChsaW5lKSAtPiBsaW5lLnNwbGl0KCdcXHQnKVxuICAgICAgICAgICAgICBkYXRhLXRvLWkxOG4gZGF0YS10YWJsZSwgZGVzdC1mb2xkZXIsIGZvcm1hdFxuICAgICAgICBlbHNlXG4gICAgICAgICAgbXNnIFwiVXNpbmcgbG9jYWwgaTE4biBzb3VyY2UgKGFzc3VtaW5nIHZhbGlkIC5YTFNYKTogI3tzcmN9XCJcbiAgICAgICAgICByZWFkLXNwcmVhZHNoZWV0IHNyY1xuICAgICAgICAgICAgLnRoZW4gKHJlc3VsdCkgLT4gZGF0YS10by1pMThuIHJlc3VsdCwgZGVzdC1mb2xkZXIsIGZvcm1hdFxuICAgICAgICAgICAgLmNhdGNoIChyZWFzb24pIC0+IGNvbnNvbGUubG9nIHJlYXNvblxuXG5hcmd2ID0gcmVxdWlyZSgnbWluaW1pc3QnKShwcm9jZXNzLmFyZ3Yuc2xpY2UoMikpXG5tc2cgSlNPTi5zdHJpbmdpZnkgYXJndlxuZGVzdC1mb2xkZXIgPSBhcmd2LnAgfHwgJy4nXG5mb3JtYXQgPSBhcmd2LmYgfHwgJ3ltbCcgIyAneW1sJyAoZGVmYXVsdCkgb3IgJ2pzb24nXG5nZW4taTE4bi1mcm9tLXNyYyBhcmd2LnMsIGRlc3QtZm9sZGVyLCBmb3JtYXRcbiJdfQ==
