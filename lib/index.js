#!/usr/bin/env node
var ref$, reject, each, keys, map, elemIndex, findIndex, join, isType, compact, concat, srcTsv, msg, i18nTSVHandler, fs, slice$ = [].slice;
ref$ = require('prelude-ls'), reject = ref$.reject, each = ref$.each, keys = ref$.keys, map = ref$.map, elemIndex = ref$.elemIndex, findIndex = ref$.findIndex, join = ref$.join, isType = ref$.isType, compact = ref$.compact, concat = ref$.concat;
if (process.argv.length > 2) {
  srcTsv = process.argv[2];
}
msg = function(m){
  return console.log("i18n-gen: " + m);
};
i18nTSVHandler = function(sourceText){
  var ref$, header, lines, locales, headerItems, prefixKeys;
  ref$ = sourceText.split('\r\n'), header = ref$[0], lines = slice$.call(ref$, 1);
  locales = {};
  headerItems = header.split('\t');
  each(function(it){
    if (it !== '' && it !== '#' && it !== 'remark') {
      return locales[it] = elemIndex(it, headerItems);
    }
  })(
  headerItems);
  msg("Generating .yml files ...");
  each(function(lang){
    var yamlLines, outputFile;
    yamlLines = join('\n')(
    map(function(line){
      var lineItems, keyIndex, indentNKey;
      lineItems = line.split('\t');
      keyIndex = findIndex(function(it){
        return it !== '';
      })(
      lineItems);
      if (!isType('Undefined', keyIndex)) {
        indentNKey = repeatString$('  ', keyIndex) + "" + lineItems[keyIndex];
        return line = indentNKey + ": " + lineItems[locales[lang]];
      }
    })(
    lines));
    outputFile = lang + ".i18n.yml";
    msg("\t -> " + outputFile);
    return fs.writeFileSync(outputFile, yamlLines, {
      flag: 'w'
    });
  })(
  keys(
  locales));
  msg("Generating .json files ...");
  prefixKeys = [];
  return each(function(lang){
    var jsonLines, jsonContent, outputFile;
    jsonLines = join(',\n')(
    reject(function(it){
      return it === '';
    })(
    map(function(line){
      var jsonLine, lineItems, keyIndex, compactedItems, thisKey, thisValue;
      jsonLine = '';
      lineItems = line.split('\t');
      keyIndex = findIndex(function(it){
        return it !== '';
      })(
      lineItems);
      compactedItems = compact(lineItems);
      if (keyIndex === 0) {
        prefixKeys = [];
      }
      if (compactedItems.length === 1) {
        prefixKeys[keyIndex] = compactedItems[0];
      }
      if (compactedItems.length > 1) {
        thisKey = compactedItems[0];
        thisValue = lineItems[locales[lang]].replace(/\"/gi, '\\"');
        jsonLine = "  \"" + join('.')(
        concat([prefixKeys, [thisKey]])) + "\" : \"" + thisValue + "\"";
      }
      return jsonLine;
    })(
    lines)));
    jsonContent = "{\n" + jsonLines + "\n}";
    outputFile = lang + ".json";
    msg("\t -> " + outputFile);
    return fs.writeFileSync(outputFile, jsonContent, {
      flag: 'w'
    });
  })(
  keys(
  locales));
};
console.log("processing: " + srcTsv);
fs = require('fs');
fs.readFile(srcTsv, 'utf-8', function(err, data){
  return i18nTSVHandler(data);
});
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
//# sourceMappingURL=data:application/json;base64,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Zkc7SUFESjtJQW1CYixXQUFhLENBQUEsQ0FBQSxDQUFFLEtBQUEsQ0FBQSxDQUFBLENBQU0sU0FBVSxDQUFBLENBQUEsQ0FBQztJQUNoQyxVQUFZLENBQUEsQ0FBQSxDQUFLLElBQUksQ0FBQSxDQUFBLENBQUM7SUFDdEIsSUFBSSxRQUFBLENBQUEsQ0FBQSxDQUFTLFVBQWI7V0FDQSxFQUFHLENBQUMsY0FBYyxZQUFhLGFBQWM7TUFBRSxNQUFNO0lBQVIsQ0FBM0I7R0F2Qkk7RUFBYjtFQUFYOztBQXlCRixPQUFPLENBQUMsSUFBSSxjQUFBLENBQUEsQ0FBQSxDQUFlLE1BQW5CO0FBQ1IsRUFBRyxDQUFBLENBQUEsQ0FBRSxRQUFRLElBQUE7QUFFYixFQUFFLENBQUMsU0FDRCxRQUNBLFNBQ0EsUUFBQSxDQUFBLEdBQUEsRUFBQSxJQUFBO1NBQ0UsZUFBZSxJQUFEO0NBSGhCIiwic291cmNlc0NvbnRlbnQiOlsiYGAjIS91c3IvYmluL2VudiBub2RlYGBcblxueyByZWplY3QsIGVhY2gsIGtleXMsIG1hcCwgZWxlbS1pbmRleCwgZmluZC1pbmRleCwgam9pbiwgaXMtdHlwZSwgY29tcGFjdCwgY29uY2F0IH0gPSByZXF1aXJlKCdwcmVsdWRlLWxzJylcbmlmIHByb2Nlc3MuYXJndi5sZW5ndGggPiAyXG4gIHNyYy10c3YgPSBwcm9jZXNzLmFyZ3YuMlxuXG5tc2cgPSAobSkgLT4gY29uc29sZS5sb2cgXCJpMThuLWdlbjogI3ttfVwiXG5cbmkxOG5UU1ZIYW5kbGVyID0gKHNvdXJjZS10ZXh0KSAtPlxuXG4gICMgQXNzdW1pbmcgZmlyc3QgbGluZSBpcyAnaGVhZGVyJyBhbmQgc3RhcnRzIHdpdGggJyMnXG4gIFsgaGVhZGVyLCAuLi5saW5lcyBdID0gc291cmNlLXRleHQuc3BsaXQgJ1xcclxcbidcbiAgbG9jYWxlcyA9IHt9ICMgZS5nLiB7J2VuJzozLCAnemgnOjR9XG4gIGhlYWRlci1pdGVtcyA9IGhlYWRlci5zcGxpdCAnXFx0J1xuICBoZWFkZXItaXRlbXMgfD4gZWFjaCAtPlxuICAgIGlmIChpdCBub3QgaW4gWyAnJyAnIycgJ3JlbWFyayddKVxuICAgICAgbG9jYWxlc1tpdF0gPSBlbGVtLWluZGV4IGl0LCBoZWFkZXItaXRlbXNcblxuICBtc2cgXCJHZW5lcmF0aW5nIC55bWwgZmlsZXMgLi4uXCJcblxuICBsb2NhbGVzIHw+IGtleXMgfD4gZWFjaCAobGFuZyktPlxuICAgIHlhbWwtbGluZXMgPSBsaW5lc1xuICAgICAgICAgICAgICB8PiBtYXAgKGxpbmUpLT5cbiAgICAgICAgICAgICAgICAgIGxpbmUtaXRlbXMgPSBsaW5lLnNwbGl0ICdcXHQnXG4gICAgICAgICAgICAgICAgICAjIGZpbmQgMXN0IG5vbi1lbXB0eSBjb2x1bW4gb2YgdGhlIGxpbmUuXG4gICAgICAgICAgICAgICAgICAjIHdoaWNoIGlzIHRoZSBrZXktaW5kZXggb2YgdGhlIGNvcnJlc3BvbmRpbmcgeWFtbCBsaW5lXG4gICAgICAgICAgICAgICAgICBrZXktaW5kZXggPSBsaW5lLWl0ZW1zIHw+IGZpbmQtaW5kZXggLT4gaXQgIT0gJydcbiAgICAgICAgICAgICAgICAgIHVubGVzcyBpcy10eXBlICdVbmRlZmluZWQnLCBrZXktaW5kZXhcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50LW4ta2V5ID0gXCIjeycgICcgKiBrZXktaW5kZXh9I3tsaW5lLWl0ZW1zW2tleS1pbmRleF19XCJcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9IFwiI3tpbmRlbnQtbi1rZXl9OiAje2xpbmUtaXRlbXNbbG9jYWxlc1tsYW5nXV19XCJcbiAgICAgICAgICAgICAgfD4gam9pbiAnXFxuJ1xuICAgIG91dHB1dC1maWxlID0gXCIje2xhbmd9LmkxOG4ueW1sXCJcbiAgICBtc2cgXCJcXHQgLT4gI3tvdXRwdXQtZmlsZX1cIlxuICAgIGZzIC53cml0ZUZpbGVTeW5jIG91dHB1dC1maWxlLCB5YW1sLWxpbmVzLCB7IGZsYWc6ICd3J31cblxuICBtc2cgXCJHZW5lcmF0aW5nIC5qc29uIGZpbGVzIC4uLlwiXG4gIHByZWZpeC1rZXlzID0gW11cbiAgbG9jYWxlcyB8PiBrZXlzIHw+IGVhY2ggKGxhbmcpLT5cbiAgICBqc29uLWxpbmVzID0gbGluZXNcbiAgICAgICAgICAgICAgfD4gbWFwIChsaW5lKS0+XG4gICAgICAgICAgICAgICAgICBqc29uLWxpbmUgPSAnJ1xuICAgICAgICAgICAgICAgICAgbGluZS1pdGVtcyA9IGxpbmUuc3BsaXQgJ1xcdCdcbiAgICAgICAgICAgICAgICAgICMgZmluZCAxc3Qgbm9uLWVtcHR5IGNvbHVtbiBvZiB0aGUgbGluZS5cbiAgICAgICAgICAgICAgICAgICMgd2hpY2ggaXMgdGhlIGtleS1pbmRleCBvZiB0aGUgY29ycmVzcG9uZGluZyB5YW1sIGxpbmVcbiAgICAgICAgICAgICAgICAgIGtleS1pbmRleCA9IGxpbmUtaXRlbXMgfD4gZmluZC1pbmRleCAtPiBpdCAhPSAnJ1xuICAgICAgICAgICAgICAgICAgY29tcGFjdGVkLWl0ZW1zID0gY29tcGFjdChsaW5lLWl0ZW1zKVxuICAgICAgICAgICAgICAgICAgaWYga2V5LWluZGV4ID09IDAgIyB0b3AgbGV2ZWwga2V5XG4gICAgICAgICAgICAgICAgICAgIHByZWZpeC1rZXlzIDo9IFtdICMgcmVzZXQgcHJlZml4LWtleXMgYXJyYXlcbiAgICAgICAgICAgICAgICAgIGlmIGNvbXBhY3RlZC1pdGVtcy5sZW5ndGggPT0gMSAjIGxpbmUgd2l0aCBvbmx5IG9uZSBwcmVmaXgta2V5XG4gICAgICAgICAgICAgICAgICAgIHByZWZpeC1rZXlzW2tleS1pbmRleF0gPSBjb21wYWN0ZWQtaXRlbXNbMF0gIyByZXBsYWNlIHByZWZpeC1rZXlzXG4gICAgICAgICAgICAgICAgICBpZiBjb21wYWN0ZWQtaXRlbXMubGVuZ3RoID4gMSAjIGxpbmUgY29udGFpbmluZyBib3R0b20gbGV2ZWwga2V5IGFuZCBsYW5nIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMta2V5ID0gY29tcGFjdGVkLWl0ZW1zWzBdXG4gICAgICAgICAgICAgICAgICAgIHRoaXMtdmFsdWUgPSBsaW5lLWl0ZW1zW2xvY2FsZXNbbGFuZ11dLnJlcGxhY2UoL1xcXCIvZ2ksJ1xcXFxcXFwiJykgIyBlc2NhcGUgZG91YmxlIHF1b3RlICdcIidcbiAgICAgICAgICAgICAgICAgICAganNvbi1saW5lIDo9IFwiICBcXFwiI3soIGNvbmNhdCBbIHByZWZpeC1rZXlzLCBbIHRoaXMta2V5IF0gXSB8PiBqb2luICcuJyApfVxcXCIgOiBcXFwiI3t0aGlzLXZhbHVlfVxcXCJcIlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzb24tbGluZVxuICAgICAgICAgICAgICB8PiByZWplY3QgLT4gaXQgPT0gJycgIyByZW1vdmUgZW1wdHkgbGluZXNcbiAgICAgICAgICAgICAgfD4gam9pbiAnLFxcbidcbiAgICBqc29uLWNvbnRlbnQgPSBcIntcXG4je2pzb24tbGluZXN9XFxufVwiXG4gICAgb3V0cHV0LWZpbGUgPSBcIiN7bGFuZ30uanNvblwiXG4gICAgbXNnIFwiXFx0IC0+ICN7b3V0cHV0LWZpbGV9XCJcbiAgICBmcyAud3JpdGVGaWxlU3luYyBvdXRwdXQtZmlsZSwganNvbi1jb250ZW50LCB7IGZsYWc6ICd3J31cblxuY29uc29sZS5sb2cgXCJwcm9jZXNzaW5nOiAje3NyYy10c3Z9XCJcbmZzID0gcmVxdWlyZSAnZnMnXG5cbmZzLnJlYWRGaWxlIGRvXG4gIHNyYy10c3ZcbiAgJ3V0Zi04J1xuICAoZXJyLCBkYXRhKSAtPlxuICAgIGkxOG5UU1ZIYW5kbGVyKGRhdGEpXG4iXX0=
